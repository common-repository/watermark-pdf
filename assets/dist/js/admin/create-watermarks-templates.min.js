/*! For license information please see create-watermarks-templates.min.js.LICENSE.txt */
(()=>{"use strict";function t(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"bg-primary",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4e3,a={success:"bg-primary",error:"bg-danger",danger:"bg-danger",warning:"bg-warning",info:"bg-info"},n=jQuery(".gpls-general-toast"),i=n.find(".btn-close");e=e.startsWith("bg-")?e:e in a?a[e]:e,n.removeClass("bg-primary bg-danger").addClass(e),n.find(".toast-msg").html(t),n.collapse("show"),r&&setTimeout((function(){n.collapse("hide")}),r),i.on("click",(function(){n.collapse("hide")}))}function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"show";"show"===t?jQuery(".loader").removeClass("d-none").show():jQuery(".loader").addClass("d-none").hide()}function r(t){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(t)}function a(){a=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function c(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,r){return t[e]=r}}function d(t,e,r,a){var n=e&&e.prototype instanceof h?e:h,i=Object.create(n.prototype),o=new P(a||[]);return i._invoke=function(t,e,r){var a="suspendedStart";return function(n,i){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===n)throw i;return{value:void 0,done:!0}}for(r.method=n,r.arg=i;;){var o=r.delegate;if(o){var s=x(o,r);if(s){if(s===u)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===a)throw a="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);a="executing";var l=p(t,e,r);if("normal"===l.type){if(a=r.done?"completed":"suspendedYield",l.arg===u)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(a="completed",r.method="throw",r.arg=l.arg)}}}(t,r,o),i}function p(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=d;var u={};function h(){}function f(){}function m(){}var v={};c(v,o,(function(){return this}));var w=Object.getPrototypeOf,g=w&&w(w(_([])));g&&g!==e&&n.call(g,o)&&(v=g);var y=m.prototype=h.prototype=Object.create(v);function k(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function b(t,e){function a(i,o,s,l){var c=p(t[i],t,o);if("throw"!==c.type){var d=c.arg,u=d.value;return u&&"object"==r(u)&&n.call(u,"__await")?e.resolve(u.__await).then((function(t){a("next",t,s,l)}),(function(t){a("throw",t,s,l)})):e.resolve(u).then((function(t){d.value=t,s(d)}),(function(t){return a("throw",t,s,l)}))}l(c.arg)}var i;this._invoke=function(t,r){function n(){return new e((function(e,n){a(t,r,e,n)}))}return i=i?i.then(n,n):n()}}function x(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,x(t,e),"throw"===e.method))return u;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var a=p(r,t.iterator,e.arg);if("throw"===a.type)return e.method="throw",e.arg=a.arg,e.delegate=null,u;var n=a.arg;return n?n.done?(e[t.resultName]=n.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,u):n:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,u)}function T(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function W(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function P(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(T,this),this.reset(!0)}function _(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,a=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return a.next=a}}return{next:O}}function O(){return{value:void 0,done:!0}}return f.prototype=m,c(y,"constructor",m),c(m,"constructor",f),f.displayName=c(m,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===f||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,m):(t.__proto__=m,c(t,l,"GeneratorFunction")),t.prototype=Object.create(y),t},t.awrap=function(t){return{__await:t}},k(b.prototype),c(b.prototype,s,(function(){return this})),t.AsyncIterator=b,t.async=function(e,r,a,n,i){void 0===i&&(i=Promise);var o=new b(d(e,r,a,n),i);return t.isGeneratorFunction(r)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},k(y),c(y,l,"Generator"),c(y,o,(function(){return this})),c(y,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var a=e.pop();if(a in t)return r.value=a,r.done=!1,r}return r.done=!0,r}},t.values=_,P.prototype={constructor:P,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(W),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(r,a){return o.type="throw",o.arg=t,e.next=r,a&&(e.method="next",e.arg=void 0),!!a}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],o=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var s=n.call(i,"catchLoc"),l=n.call(i,"finallyLoc");if(s&&l){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var i=a;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=t,o.arg=e,i?(this.method="next",this.next=i.finallyLoc,u):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),u},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),W(r),u}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var a=r.completion;if("throw"===a.type){var n=a.arg;W(r)}return n}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:_(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),u}},t}function n(t,e,r,a,n,i,o){try{var s=t[i](o),l=s.value}catch(t){return void r(t)}s.done?e(l):Promise.resolve(l).then(a,n)}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){for(var r=0;r<e.length;r++){var a=e[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}var s=function(){function e(t,r,a,n,o,s){var l=arguments.length>6&&void 0!==arguments[6]&&arguments[6],c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:{};i(this,e),this.ajaxUrl=t,this.method=r,this.data=a,this.successCallback=n,this.errorCallback=o,this.completeCallback=s,this.showToast=(null==c?void 0:c.showToast)||!1,this.createNewToast=(null==c?void 0:c.createNewToast)||!1,this.toastDuration=(null==c?void 0:c.toastDuration)||!1,this.showToastHeader=(null==c?void 0:c.showToastHeader)||!1,l&&this.fire()}var r,s,l,c,d;return l=e,c=[{key:"fire",value:function(){var e=this;jQuery.ajax({method:this.method,url:this.ajaxUrl,data:this.data,success:function(r){var a;null!=r&&null!==(a=r.data)&&void 0!==a&&a.message&&e.showToast&&t(r.data.message,r.data.status,e.toastDuration,"",e.showToastHeader,e.createNewToast),e.successCallback(r)},error:function(r){var a,n,i,o;null!=r&&null!==(a=r.responseJSON)&&void 0!==a&&null!==(n=a.data)&&void 0!==n&&n.message&&r.responseJSON.data.message.length&&e.showToast&&t(r.responseJSON.data.message,r.responseJSON.data.status,e.toastDuration,"",e.showToastHeader,e.createNewToast),null!=r&&null!==(i=r.responseJSON)&&void 0!==i&&null!==(o=i.data)&&void 0!==o&&o.message||null==r||!r.responseText||!e.showToast||t(r.responseText,"bg-danger",e.toastDuration,"",!0,!0),e.errorCallback(r)},complete:function(){e.completeCallback()}})}},{key:"asyncFire",value:(r=a().mark((function e(){var r=this;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,jQuery.ajax({method:this.method,url:this.ajaxUrl,data:this.data,success:function(e){var a;return null!=e&&null!==(a=e.data)&&void 0!==a&&a.message&&e.data.message.length&&r.showToast&&t(e.data.message,e.data.status,r.toastDuration,"",r.showToastHeader,r.createNewToast),r.successCallback(e),e},error:function(e){var a,n,i,o;return console.log("error in ajax",e),null!=e&&null!==(a=e.responseJSON)&&void 0!==a&&null!==(n=a.data)&&void 0!==n&&n.message&&e.responseJSON.data.message.length&&r.showToast&&t(e.responseJSON.data.message,e.responseJSON.data.status,r.toastDuration,"",r.showToastHeader,r.createNewToast),null!=e&&null!==(i=e.responseJSON)&&void 0!==i&&null!==(o=i.data)&&void 0!==o&&o.message||null==e||!e.responseText||!r.showToast||t(e.responseText,"bg-danger",r.toastDuration,"",!0,!0),r.errorCallback(e),null!=e&&e.responseJSON?e.responseJSON:e.responseText},complete:function(){r.completeCallback()}});case 3:return e.abrupt("return",e.sent);case 6:return e.prev=6,e.t0=e.catch(0),e.abrupt("return",null!==e.t0&&void 0!==e.t0&&e.t0.responseJSON?e.t0.responseJSON:e.t0.responseText);case 9:case"end":return e.stop()}}),e,this,[[0,6]])})),s=function(){var t=this,e=arguments;return new Promise((function(a,i){var o=r.apply(t,e);function s(t){n(o,a,i,s,l,"next",t)}function l(t){n(o,a,i,s,l,"throw",t)}s(void 0)}))},function(){return s.apply(this,arguments)})}],c&&o(l.prototype,c),d&&o(l,d),Object.defineProperty(l,"prototype",{writable:!1}),e}();function l(t){return l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},l(t)}function c(t,e){for(var r=0;r<e.length;r++){var a=e[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function d(){d=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,a="function"==typeof Symbol?Symbol:{},n=a.iterator||"@@iterator",i=a.asyncIterator||"@@asyncIterator",o=a.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function c(t,e,r,a){var n=e&&e.prototype instanceof h?e:h,i=Object.create(n.prototype),o=new P(a||[]);return i._invoke=function(t,e,r){var a="suspendedStart";return function(n,i){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===n)throw i;return{value:void 0,done:!0}}for(r.method=n,r.arg=i;;){var o=r.delegate;if(o){var s=x(o,r);if(s){if(s===u)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===a)throw a="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);a="executing";var l=p(t,e,r);if("normal"===l.type){if(a=r.done?"completed":"suspendedYield",l.arg===u)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(a="completed",r.method="throw",r.arg=l.arg)}}}(t,r,o),i}function p(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=c;var u={};function h(){}function f(){}function m(){}var v={};s(v,n,(function(){return this}));var w=Object.getPrototypeOf,g=w&&w(w(_([])));g&&g!==e&&r.call(g,n)&&(v=g);var y=m.prototype=h.prototype=Object.create(v);function k(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function b(t,e){function a(n,i,o,s){var c=p(t[n],t,i);if("throw"!==c.type){var d=c.arg,u=d.value;return u&&"object"==l(u)&&r.call(u,"__await")?e.resolve(u.__await).then((function(t){a("next",t,o,s)}),(function(t){a("throw",t,o,s)})):e.resolve(u).then((function(t){d.value=t,o(d)}),(function(t){return a("throw",t,o,s)}))}s(c.arg)}var n;this._invoke=function(t,r){function i(){return new e((function(e,n){a(t,r,e,n)}))}return n=n?n.then(i,i):i()}}function x(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,x(t,e),"throw"===e.method))return u;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var a=p(r,t.iterator,e.arg);if("throw"===a.type)return e.method="throw",e.arg=a.arg,e.delegate=null,u;var n=a.arg;return n?n.done?(e[t.resultName]=n.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,u):n:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,u)}function T(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function W(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function P(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(T,this),this.reset(!0)}function _(t){if(t){var e=t[n];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,i=function e(){for(;++a<t.length;)if(r.call(t,a))return e.value=t[a],e.done=!1,e;return e.value=void 0,e.done=!0,e};return i.next=i}}return{next:O}}function O(){return{value:void 0,done:!0}}return f.prototype=m,s(y,"constructor",m),s(m,"constructor",f),f.displayName=s(m,o,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===f||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,m):(t.__proto__=m,s(t,o,"GeneratorFunction")),t.prototype=Object.create(y),t},t.awrap=function(t){return{__await:t}},k(b.prototype),s(b.prototype,i,(function(){return this})),t.AsyncIterator=b,t.async=function(e,r,a,n,i){void 0===i&&(i=Promise);var o=new b(c(e,r,a,n),i);return t.isGeneratorFunction(r)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},k(y),s(y,o,"Generator"),s(y,n,(function(){return this})),s(y,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var a=e.pop();if(a in t)return r.value=a,r.done=!1,r}return r.done=!0,r}},t.values=_,P.prototype={constructor:P,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(W),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function a(r,a){return o.type="throw",o.arg=t,e.next=r,a&&(e.method="next",e.arg=void 0),!!a}for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n],o=i.completion;if("root"===i.tryLoc)return a("end");if(i.tryLoc<=this.prev){var s=r.call(i,"catchLoc"),l=r.call(i,"finallyLoc");if(s&&l){if(this.prev<i.catchLoc)return a(i.catchLoc,!0);if(this.prev<i.finallyLoc)return a(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return a(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return a(i.finallyLoc)}}}},abrupt:function(t,e){for(var a=this.tryEntries.length-1;a>=0;--a){var n=this.tryEntries[a];if(n.tryLoc<=this.prev&&r.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=t,o.arg=e,i?(this.method="next",this.next=i.finallyLoc,u):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),u},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),W(r),u}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var a=r.completion;if("throw"===a.type){var n=a.arg;W(r)}return n}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:_(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),u}},t}function p(t,e,r,a,n,i,o){try{var s=t[i](o),l=s.value}catch(t){return void r(t)}s.done?e(l):Promise.resolve(l).then(a,n)}function u(t){return function(){var e=this,r=arguments;return new Promise((function(a,n){var i=t.apply(e,r);function o(t){p(i,a,n,o,s,"next",t)}function s(t){p(i,a,n,o,s,"throw",t)}o(void 0)}))}}function h(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}!function(t){var r="gpls-wmpdf-watermark-pdf",a="gpls_wmpdf_watermark_pdf",n=window[a+"_localize_vars"],i=null,o={},l={},p=null,f=!1,m=0,v=0;function w(t){return g.apply(this,arguments)}function g(){return(g=u(d().mark((function t(e){var r;return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=new s(n.ajaxUrl,"POST",{action:"get_pdf_dimensions",pdfURL:e,nonce:n.nonce},(function(t){console.log("succes",t),t.data&&t.data.msg&&x(t.data.msg,"bg-"+t.data.status)}),(function(t){console.log("error",t),t.data&&t.data.msg&&x(t.data.msg,"bg-danger")}),(function(){})),t.next=3,r.asyncFire();case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t)})))).apply(this,arguments)}t.fn.resized=function(e,r){t(this).resize((function(){var a=t(this);a.data("resizeTimeout")&&clearTimeout(a.data("resizeTimeout")),a.data("resizeTimeout",setTimeout(e,r))}))},t(document).on("ready",(function(){var a;t("#visibility").remove(),l.width=window.outerWidth,l.height=window.outerHeight,[].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]')).map((function(t){return new bootstrap.Tooltip(t)})),[].slice.call(document.querySelectorAll(".accordion-collapse")).map((function(t){return new bootstrap.Collapse(t,{toggle:!1})})),t(".gpls-wmpdf-open-gallery-btn").on("click",(function(s){s.preventDefault();var l=t(this).data("context"),c={title:"select-watermark"===l?n.labels.select_watermark:n.labels.select_image,library:h({orderby:"date",query:!0,post_mime_type:"select-watermark"===l?n.img_mime_types:n.pdf_mime_types},r+"-context-modal",l),button:{text:"select-watermark"===l?n.labels.select_watermark:n.labels.select_image},multiple:!1};(a=wp.media(c)).open(),a.on("select",u(d().mark((function r(){var n,s,c,p;return d().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=a.state().get("selection").toJSON(),"select-preview-image"!==l){r.next=20;break}return o=n[0],e("show"),r.next=6,w(o.url);case 6:if(c=r.sent,e("hide"),null==c||null===(s=c.data)||void 0===s||!s.dimensions){r.next=13;break}o.width=c.data.dimensions.width,o.height=c.data.dimensions.height,r.next=14;break;case 13:return r.abrupt("return");case 14:t(".select-watermark-btn-section").removeClass("d-none"),t(".selected-preview-img-id").val(o.id),p=o.type,i.initPDF(p),r.next=21;break;case 20:"select-watermark"===l&&(m++,v++,i.addWatermark("image",n[0],!0));case 21:case"end":return r.stop()}}),r)}))))})),(i=new y).initCurrentPreview(),i.initCurrentWatermarks(),t(".cpt-terms-select").each((function(e){k(t(this).attr("id"),t(this).data("cpt"),t(this).data("tax"))})),t(".cpt-author-select").each((function(e){b(t(this).attr("id"))}))}));var y=function(){function e(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this.canvas=document.createElement("canvas"),this.activePlaceholder=null,this.editsElement=t(".preview-selected-wrapper .edits"),this.watermarks={},this.watermarksElements={},this.lastTextDegree=0,this.spotsMapping={tl:{left:0,top:0},tm:{left:1,top:0},tr:{left:2,top:0},ml:{left:0,top:1},mm:{left:1,top:1},mr:{left:2,top:1},bl:{left:0,top:2},bm:{left:1,top:2},br:{left:2,top:2}},this.events()}var s,l;return s=e,l=[{key:"events",value:function(){var e=this;t(".edits").on("click",".edits-close",(function(e){t(".preview-selected-wrapper .edits").addClass("d-none")})),t(document).on("mouseenter",".actions",(function(e){t(e.target).removeClass("d-none")})),t(document).on("click",".watermark-placeholder",(function(r){var a=t(r.target),n=(a.hasClass(".watermark-placeholder")?a:a.closest(".watermark-placeholder")).attr("item"),i=t('.watermark-placeholder[item="'+n+'"]');e.activateWatermarkSpecsItem(n),i.css("zIndex",200),i.siblings(".watermark-placeholder").css("zIndex",2)})),t(document).on("click",".accordion-button",(function(e){var r=t(e.target).data("id"),a=t('.watermark-placeholder[item="'+r+'"]');a.css("zIndex",200),a.siblings(".watermark-placeholder").css("zIndex",2)})),t(document).on("mouseenter","#selected-preview-container",(function(e){t(".watermark-placeholder").find(".actions").removeClass("d-none")})),t(document).on("mouseleave","#selected-preview-container",(function(e){t(".watermark-placeholder").find(".actions").addClass("d-none")})),t(document).on("keypress",".watermark-text-textarea",(function(t){13===t.which&&t.preventDefault()})),t(document).on("keyup",".watermark-text-textarea",(function(r){var a=t(r.target),n=a.parents(".watermark-placeholder-text").attr("item"),i=e.watermarks[n];t("#"+n+"_specs").find(".edit-title").val(a.text()),i=e.updateWatermarkTextOffsets(i),e.repeatWatermarkPlaceholder(i)})),t(document).on("mousedown",".watermark-placeholder-rotate-handle",(function(e){t(e.target).parents(".watermark-placeholder").rotatable("instance").startRotate(e)})),t(document).on("click",".actions .action-edit",(function(r){var a=t(r.target).closest(".watermark-placeholder").attr("item");e.activateWatermarkSpecsItem(a)})),t(document).on("click",".watermark-specs-header",(function(e){var r=t(e.target).data("id"),a=t('.watermark-placeholder[item="'+r+'"]');a.length&&(a.find(".actions").removeClass("d-none"),a.siblings().find(".actions").addClass("d-none"))})),t(document).on("click",".accordion-item .action-remove",(function(r){if(confirm(n.labels.remove_watermark)){var a=t(r.target).closest(".accordion-item").data("id");m--,e.removeWatermark(a)}})),t(document).on("click",".actions .action-remove",(function(r){if(confirm(n.labels.remove_watermark)){var a=t(r.target).parents(".watermark-placeholder").attr("item");m--,e.removeWatermark(a)}})),t(document).on("input change",".watermark-specs .edit",(function(a,n){n!==r+"-pypass-repeat"&&clearTimeout(p),p=setTimeout((function(){var r=t(a.target),n=r.data("type"),i=r.val(),o=r.closest(".accordion-item").data("id"),s=e.watermarks[o],l=t('.watermark-placeholder[item="'+o+'"]'),c=t("#"+o+"_specs"),d=s.styles;if("opacity"===n||"degree"===n){if(isNaN(i))return;if("text"===s.type){if(i>90&&i<270)return i=i<e.lastTextDegree?90:270,e.lastTextDegree=i,void c.find(".edit-degree").val(i).trigger("change");e.lastTextDegree=i}d[n]="degree"===n&&i<0?360-Math.abs(i):i}else if("position-type"===n){var p=c.find("."+i+"-position");p.collapse("show"),p.siblings(".position-type-input").collapse("hide"),s=e.updateWatermark(s,{position:{positionType:i}})}else if("position-left-percent"===n){if(isNaN(i))return;s=e.updateWatermark(s,{position:{leftPercent:i}})}else if("position-top-percent"===n){if(isNaN(i))return;s=e.updateWatermark(s,{position:{topPercent:i}})}else if("position-spot"===n)s=e.updateWatermark(s,{position:{positionSpot:i}});else if("position-left"===n){if(isNaN(i))return;s=e.updateWatermark(s,{position:{left:i}})}else if("position-top"===n){if(isNaN(i))return;s=e.updateWatermark(s,{position:{top:i}})}else"position-center-offset"===n?s=e.updateWatermark(s,{position:{centerOffset:r.is(":checked")}}):"width"===n?s=e.updateWatermark(s,{width:i}):"height"===n?s=e.updateWatermark(s,{height:i}):d.font[n]=i;"title"===n&&(s=e.updateWatermark(s,{text:i}),l.find(".watermark-text-textarea").text(i)),e.updateWatermarkPlaceholderStyles(l,d,s),"text"===(s=e.updateWatermarkStyles(s,d)).type&&(s=e.updateWatermarkTextOffsets(s)),e.updateWatermarkPlaceholderStyles(l,d,s),e.repeatWatermarkPlaceholder(s)}),200)})),t(document).on(a+"_preview_watermark_save_toggle",(function(e,r){r?(t(".preview-watermark-preview-btn").removeClass("disabled").prop("disabled",!1),t(".preview-watermark-preview-btn").removeClass("d-none")):(t(".preview-watermark-preview-btn").addClass("disabled").prop("disabled",!0),t(".preview-watermark-preview-btn").addClass("d-none"))})),t(document).on("click",".gpls-wmpdf-add-text-watermark",(function(t){t.preventDefault(),m++,v++,i.addWatermark("text",{},!0)})),t(document).on("input",".watermark-text-textarea",(function(r){if(13!==r.keyCode){var a=t(r.target),n=a.parents(".watermark-placeholder-text").attr("item"),i=e.watermarks[n],o=a.text();e.updateWatermark(i,{text:o}),e.updateWatermarkStyles(i,i.styles)}else r.preventDefault()})),t(document).on("click",".preview-watermark-preview-btn",(function(t){e.previewWatermarks(t)})),t(document).on("change",".edit-position-repeat-status",(function(r){var a=t(r.target),n=a.is(":checked"),i=a.data("watermarkid"),o=t("#"+i+"_specs"),s=e.watermarks[i];o.find(".repeat-axis-wrapper").collapse(n?"show":"hide"),s.isRepeat=n,e.directUpdateWatermark(s),e.repeatWatermarkPlaceholder(s)})),t(document).on("change",".repeat-axis-select",(function(r){var a=t(r.target),n=a.val(),i=a.data("watermarkid"),o=e.watermarks[i];o.repeatAxis=n,e.directUpdateWatermark(o),e.repeatWatermarkPlaceholder(o)})),t(document).on("change",".repeat-axis-offset-input",(function(r){var a=t(r.target),n=a.val(),i=a.data("watermarkid"),o=a.data("axistype"),s=e.watermarks[i];"x"===o?s.repeatXAxisOffset=n:s.repeatYAxisOffset=n,e.directUpdateWatermark(s),e.repeatWatermarkPlaceholder(s)})),t(document).on("change",".auto-apply-status",(function(e){var r=t(e.target).is(":checked"),a=t("#apply-type-overwrite").is(":checked"),n=t(".auto-apply-context").is(":checked");t(".step-2").collapse(r?"show":"hide"),r&&a&&t(".create-backup").collapse("show"),r&&n&&t(".step-3").collapse("show"),r||t(".step-3").collapse("hide")})),t(document).on("change",".auto-apply-img-dimension-status",(function(e){var r=t(e.target).is(":checked");t(".auto-apply-img-dimension").collapse(r?"show":"hide")})),t(document).on("change",".auto-apply-context",(function(e){var r=t(".auto-apply-context").is(":checked");t(".step-3").collapse(r?"show":"hide")})),t(document).on("change",".auto-apply-context-posts",(function(e){var r=t(e.target).is(":checked");t("#auto-apply-context-filter-posts").collapse(r?"show":"hide")})),t(document).on("change",".context-posts-cpt",(function(e){var r=t(e.target),a=r.val(),n=r.is(":checked");t(".context-by-cpt-filter-"+a).collapse(n?"show":"hide")})),t(document).on("change",".apply-type-select .apply-type",(function(e){"overwrite"===t(".apply-type:checked").val()?t(".create-backup").collapse("show"):t(".create-backup").collapse("hide")})),t(document).on("click",".add-filter-rule-group",(function(r){r.preventDefault();var a=t(r.target),n=a.data("cpt"),i=a.data("counter");e.getFilterRow(a,n,i)})),t(document).on("click",".remove-group-rule",(function(e){e.preventDefault(),t(e.target).parents(".rule-group-row").remove()})),t(window).on("resize",(function(e){t(".preview-result").addClass("d-none")})),t(window).resized((function(r){var a=t(".selected-preview-pdf");o.width=Math.floor(a.width()),o.height=Math.floor(a.height()),e.initCurrentWatermarks(!1,!0)}),300)}},{key:"calculatePosition",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";e.length||(e=t.positionType);var r=this.spotsMapping[t.positionSpot],a=Math.round(o.width/3),n=Math.round(o.height/3);if("pixel"===e)var i={left:Math.round(r.left*a)+parseInt(t.absLeft),top:Math.round(r.top*n)+parseInt(t.absTop)};else"percent"===e&&(i={left:Math.round(r.left*a)+parseInt(a*parseFloat(t.leftPercent/100)),top:Math.round(r.top*n)+parseInt(n*parseFloat(t.topPercent/100))});return t.centerOffset&&(i.left-=Math.round(t.width/2),i.top-=Math.round(t.height/2)),i}},{key:"initCurrentPreview",value:function(){o=n.current_watermarks.preview?n.current_watermarks.preview:n.current_watermarks.default_preview,t(".selected-preview-pdf"),this.initPDF()}},{key:"initCurrentWatermarks",value:function(){var e,r=this,a=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(a){if(null!=n&&null!==(e=n.current_watermarks)&&void 0!==e&&e.watermarks){var o=n.current_watermarks.watermarks;m=Object.keys(o).length,v=Object.keys(o).length}}else o=this.watermarks;o&&(f=!0,t.each(o,(function(e,a){i&&r.removeWatermark(a.id,!0),r.addWatermark(a.type,a,!1,a,!1),r.initWatermarkSpecs(a.id);var n=t('.watermark-placeholder[item="'+a.id+'"]');r.updateWatermarkPlaceholderStyles(n,a.styles,a),"text"===a.type&&(n.find(".watermark-text-textarea").text(a.text),r.updateWatermarkTextOffsets(a)),r.updateWatermarkStyles(a.id,a.styles),r.updateWatermarkSpecs(a.id,a),r.repeatWatermarkPlaceholder(a)})),f=!1)}},{key:"updateCurrentWatermarksPosition",value:function(){var e=this;t.each(this.watermarks,(function(r,a){"pixel"===a.positionType?(a.absLeft,a.absTop):(a.topPercent,a.leftPercent);var n=t('.watermark-placeholder[item="'+a.id+'"]');e.updateWatermarkPlaceholderStyles(n,a.styles,a)}))}},{key:"activateWatermarkSpecsItem",value:function(e){var r=t('.accordion-button[data-id="'+e+'"]');r&&r.hasClass("collapsed")&&r.trigger("click")}},{key:"insertWatermarkToList",value:function(e){var a=t("#"+r+"-added-watermarks-list");if(a.length){a.find(".watermarks-list-accordion").append(this.watermarksAccordionItemHTML(e,m));var n=t(".watermark-specs-placeholder").clone().attr("id","watermark-specs-item-"+e.id).removeClass("watermark-specs-placeholder").addClass("watermark-specs").removeClass("d-none");n.append(this.watermarkAccordionInputs(e)),t("#"+e.id+"_specs").find(".accordion-body").html(n),this.initWatermarkSpecs(e.id),t('.watermark-placeholder[item="'+e.id+'"]').find(".watermark-placeholder-wrapper").trigger("click")}}},{key:"watermarksAccordionItemHTML",value:function(t,e){var r=t.id;return'<div class="accordion-item" data-id="'+r+'" >\n            <h4 class="accordion-header watermark-specs-header" id="'+r+'_header" data-index="'+(e-1)+'" data-id="'+r+'">\n                <div class="header-wrapper d-flex flex-row align-items-center" style="height: 60px;">\n                    <button class="accordion-button collapsed" type="button" data-id="'+r+'" data-bs-toggle="collapse" data-bs-target="#'+r+'_specs" aria-expanded="true" aria-controls="'+r+'_specs" >\n                        Watermark '+v+" ["+this.watermarks[r].type+']\n                    </button>\n                    <span class="dashicons dashicons-dismiss action action-remove mx-2 bg-white" style="color:#F00;" type="button" data-id="'+r+'"></span>\n                </div>\n            </h4>\n            <div id="'+r+'_specs" class="accordion-collapse collapse" data-id="'+r+'" aria-labelledby="'+r+'_header" data-bs-parent="#gpls-wmpdf-watermarks-list-accordion" >\n                <div class="accordion-body">\n                </div>\n            </div>\n            </div>'}},{key:"watermarkAccordionInputs",value:function(t){var e=t.id;return'<input type="hidden" name="watermarks['+e+'][type]" value="'+t.type+'" />\n            <input type="hidden" name="watermarks['+e+'][id]" value="'+e+'" />\n            '.concat("image"===t.type?'<input type="hidden" name="watermarks['+e+'][url]" value="'+t.url+'" />\n                <input type="hidden" name="watermarks['+e+'][imgID]" value="'+t.imgID+'" />':"","\n            ")}},{key:"initWatermarkSpecs",value:function(e){var r=t("#watermark-specs-item-"+e);if(r.length){var a=this.watermarks[e];"text"===a.type?(r.find(".edit.edit-title").val(a.text).attr("name","watermarks["+e+"][title]"),r.find(".edit.edit-color").val(a.styles.font.color).attr("name","watermarks["+e+"][color]"),r.find(".edit.edit-font-size").val(a.styles.font.fontSize).attr("name","watermarks["+e+"][fontsize]"),r.find(".edit.edit-font-family").val(a.styles.font.fontFamily).attr("name","watermarks["+e+"][fontfamily]"),r.find(".edit-position-botleft").val(a.botLeft).attr("name","watermarks["+e+"][botLeft]"),r.find(".edit-position-bottop").val(a.botTop).attr("name","watermarks["+e+"][botTop]"),r.find(".edit-position-exactwidth").val(a.exactWidth).attr("name","watermarks["+e+"][exactWidth]"),r.find(".edit-position-baselineoffset").val(a.baselineOffset).attr("name","watermarks["+e+"][baselineOffset]")):"image"===a.type&&r.find(".edit-text").remove(),"text"===a.type&&r.find(".watermark-dimension-wrapper").addClass("d-none"),r.find(".edit.edit-width").val(a.width).attr("name","watermarks["+e+"][width]"),r.find(".edit.edit-height").val(a.height).attr("name","watermarks["+e+"][height]");var n=r.find(".edit-opacity");n.val(a.styles.opacity).attr("name","watermarks["+e+"][opacity]"),n.trigger("change"),r.find(".gpls-wmpdf-watermark-position-spot-"+a.positionSpot).prop("checked",!0),t.each(r.find(".edit-position-spot"),(function(r,a){t(a).attr("name","watermarks["+e+"][positionSpot]")})),r.find(".edit-position-type").attr("name","watermarks["+e+"][positionType]"),r.find(".edit-position-repeat-status").attr("name","watermarks["+e+"][isRepeat]").attr("data-watermarkid",e),r.find(".repeat-axis-select").attr("name","watermarks["+e+"][repeatAxis]").attr("data-watermarkid",e),r.find(".repeat-x-axis-offset-input").val(a.repeatXAxisOffset).attr("name","watermarks["+e+"][repeatXAxisOffset]").attr("data-watermarkid",e),r.find(".repeat-y-axis-offset-input").val(a.repeatYAxisOffset).attr("name","watermarks["+e+"][repeatYAxisOffset]").attr("data-watermarkid",e),r.find(".position-type-"+a.positionType).prop("checked",!0),r.find(".edit-position-center-offset").prop("checked",e.centerOffset),r.find(".edit-position-center-offset").attr("name","watermarks["+e+"][centerOffset]"),r.find(".edit-position-left").val(a.absLeft).attr("name","watermarks["+e+"][absLeft]"),r.find(".edit-position-top").val(a.absTop).attr("name","watermarks["+e+"][absTop]"),r.find(".edit-position-left-percent").val(a.leftPercent).attr("name","watermarks["+e+"][leftPercent]"),r.find(".edit-position-top-percent").val(a.topPercent).attr("name","watermarks["+e+"][topPercent]"),r.find(".edit-degree").val(a.styles.degree).attr("name","watermarks["+e+"][degree]"),r.find('[data-bs-toggle="tooltip"]').tooltip()}}},{key:"fillInWatermarkEditsList",value:function(t){"text"===t.type&&(this.editsElement.find(".edit-title").val(t.text),this.editsElement.find(".edit-color").val(t.styles.font.color),this.editsElement.find(".edit-font-size").val(t.styles.font.fontSize),this.editsElement.find(".edit-font-family").val(t.styles.font.fontFamily)),this.editsElement.find(".edit-opacity").val(t.styles.opacity).trigger("change")}},{key:"unique_id",value:function(){return"watermark_"+Math.round(Math.random()*Math.round(Math.random()*Date.now()))}},{key:"randomPosition",value:function(t,e){return Math.round(Math.random()*(e-t+1))+t}},{key:"initWaterMarkText",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=this;if(t)var r=t;else{var a=n.labels.watermark+" "+v,i=function(){this.id=e.unique_id(),this.type="text",this.width=50,this.height=30,this.text=a,this.centerOffset=!1,this.isRepeat=!1,this.repeatAxis="",this.repeatXAxisOffset=200,this.repeatYAxisOffset=200,this.positionSpot="mm",this.positionType="pixel",this.absLeft=Math.round(50+50*Object.keys(e.watermarks).length),this.absTop=Math.round(50+50*Object.keys(e.watermarks).length),this.leftPercent=0,this.topPercent=0,this.baselineOffset=5,this.exactWidth=50,this.botLeft=0,this.botTop=0,this.styles={font:{color:"#000000",fontSize:16,fontFamily:"verdana",opacity:1},opacity:1,degree:0}};r=new i}return r}},{key:"initWaterMarkImg",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=this;if(e)var a=e;else{var n=!0;(t.width>o.width||t.height>o.height)&&(n=!1);var i=function(){this.id=r.unique_id(),this.type="image",this.width=n?t.width:150,this.sourceWidth=t.width,this.height=n?t.height:150,this.sourceHeight=t.height,this.imgID=t.id,this.centerOffset=!1,this.isRepeat=!1,this.repeatAxis="",this.repeatXAxisOffset=200,this.repeatYAxisOffset=200,this.positionSpot="mm",this.positionType="pixel",this.absLeft=Math.round(50+50*Object.keys(r.watermarks).length),this.absTop=Math.round(50+50*Object.keys(r.watermarks).length),this.leftPercent=0,this.topPercent=0,this.url=t.url,this.styles={opacity:1,degree:0}};a=new i}return a}},{key:"updateWatermarkPlaceholderStyles",value:function(t,e,r){var a=r.type;if("image"===a)var n=t.find(".img-placeholder img");else{if("text"!==a)return;n=t.find(".watermark-text-textarea")}if(n.length){for(var i in e.font)"fontSize"===i?n.css(i,e.font[i]+"px"):n.css(i,e.font[i]);e.opacity&&n.css("opacity",e.opacity),n.width(r.width),n.height(r.height),e.degree&&this.rotateWatermarkElement(t,e.degree,a,r);var o=this.calculatePosition(r);t.css({left:o.left+"px",top:o.top+"px"})}}},{key:"rotateWatermarkElement",value:function(t,e,r,a){var n="rotate("+e+"deg)";a.centerOffset?(t.css("transform-origin","center center"),t.css("-ms-transform-origin","center center"),t.css("-webkit-transform-origin","center center")):(t.css("transform-origin","0px 0px"),t.css("-ms-transform-origin","0px 0px"),t.css("-webkit-transform-origin","0px 0px")),t.css("transform",n),t.css("-moz-transform",n),t.css("-webkit-transform",n),t.css("-o-transform",n)}},{key:"addWatermark",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"image",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if("image"===e){var s=this.initWaterMarkImg(r,i);this.watermarks[s.id]=s,t(document).trigger(a+"_preview_watermark_save_toggle",Object.keys(this.watermarks).length),this.drawWatermark(s,e,n,o)}else if("text"===e){var l=this.initWaterMarkText(i);this.watermarks[l.id]=l,t(document).trigger(a+"_preview_watermark_save_toggle",Object.keys(this.watermarks).length),this.drawWatermark(l,e,n,o)}t(".preview-watermark-preview-btn").removeClass("disabled").prop("disabled",!1)}},{key:"drawWatermark",value:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"image",a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3?arguments[3]:void 0;e=this.drawWatermarkPlaceholder(e,r,a),"text"===r&&a&&(e=this.updateWatermarkTextOffsets(e)),a&&(this.insertWatermarkToList(e),this.openWatermarkSpecsAccordion(e.id)),n&&t("html, body").animate({scrollTop:t('.watermark-placeholder[item="'+e.id+'"]').offset().top-300},500)}},{key:"openWatermarkSpecsAccordion",value:function(e){var r=t('.accordion-button[data-id="'+e+'"]');r&&r.hasClass("collapsed")&&r.trigger("click")}},{key:"resetWatermarkPlaceholder",value:function(t){this.removeWatermark(t.id,!0),this.drawWatermarkPlaceholder(t,t.type,!1)}},{key:"drawWatermarkPlaceholder",value:function(e,r,a){var n=this,i=t(".watermark-"+r+"-placeholder-none").clone().removeClass("watermark-"+r+"-placeholder-none").removeClass("d-none").addClass("watermark-placeholder watermark-placeholder-"+r);i.attr("item",e.id),t(".selected-preview-pdf").after(i),this.setWatermarkStyles(e,i),this.watermarksElements[e.id]||(this.watermarksElements[e.id]={}),this.watermarksElements[e.id]=i;var o={containment:".preview-selected-wrapper",wheelRotate:!1,snap:!0,step:5,rotate:function(e,r){var a=t(e.target).attr("item"),i=Math.round(180*r.angle.current/Math.PI),o=n.watermarks[a],s=o.type;o.styles.degree=i,"text"===s&&(i<-90?(i=-90,r.angle.current=Math.PI*i/180):i>90&&(i=90,r.angle.current=Math.PI*i/180)),-0==i&&(i=0),n.updateWatermarkSpecs(a,{degree:i})},stop:function(e,r){var a=t(e.target).attr("item"),i=Math.round(180*r.angle.current/Math.PI),o=n.watermarks[a];o.styles.degree=i,"text"===o.type&&(o=n.updateWatermarkTextOffsets(o)),-0==i&&(i=0),n.updateWatermarkSpecs(a,{degree:i}),o=n.updateWatermark(o,h({degree:i},"degree",i))}};return i.rotatable(o),"text"===r&&a&&i.find(".watermark-text-textarea").text(e.text),e}},{key:"updateWatermarkSpecs",value:function(e,r){var a=t("#watermark-specs-item-"+e);r.width&&a.find(".edit-width").val(r.width),void 0!==r.height&&a.find(".edit-height").val(r.height),void 0!==r.positionType&&a.find("#gpls-wmpdf-watermark-position-type-"+r.positionType).prop("checked",!0),void 0===r.left&&void 0===r.absLeft||a.find(".edit-position-left").val(r.left||r.absLeft),void 0===r.top&&void 0===r.absTop||a.find(".edit-position-top").val(r.top||r.absTop),void 0!==r.leftPercent&&a.find(".edit-position-left-percent").val(r.leftPercent),void 0!==r.topPercent&&a.find(".edit-position-top-percent").val(r.topPercent),void 0!==r.positionSpot&&a.find(".gpls-wmpdf-watermark-position-spot-"+r.positionSpot).prop("checked",!0),void 0!==r.botLeft&&a.find(".edit-position-botleft").val(r.botLeft),void 0!==r.botTop&&a.find(".edit-position-bottop").val(r.botTop),void 0!==r.exactWidth&&a.find(".edit-position-exactwidth").val(r.exactWidth),void 0!==r.baselineOffset&&a.find(".edit-position-baselineoffset").val(r.baselineOffset),void 0!==r.degree&&a.find(".edit-degree").val(r.degree<0?360-Math.abs(r.degree):r.degree).trigger("change")}},{key:"setWatermarkStyles",value:function(t,e){"image"===t.type&&e.find(".img-placeholder img").attr("src",t.url);var r=e.find(".watermark-text-textarea");r.css("line-height"),"text"===t.type&&(e.css({"font-family":t.styles.font.fontFamily,"font-size":t.styles.font.fontSize,width:"auto !important",height:"auto !important"}),r.css({color:t.styles.font.color})),e.position({my:"left top",at:"left top",of:"#selected-preview-container",collision:"fit"});var a=this.calculatePosition(t);e.css({left:a.left,top:a.top})}},{key:"repeatWatermarkPlaceholder",value:function(t){if(t.isRepeat&&t.repeatAxis.length){var e=o.width,r=o.height,a=parseInt(t.repeatXAxisOffset),n=parseInt(t.repeatYAxisOffset),i=this.calculatePosition(t);this.clearRepeatedPlaceholder(t.id);var s=i.left,l=i.top;if("x"===t.repeatAxis){if(a<=0)return;for(s+=a;s<e;)this.drawRepeatedPlaceholder(t,s,l),s+=a}else if("y"===t.repeatAxis){if(n<=0)return;for(l+=n;l<r;)this.drawRepeatedPlaceholder(t,s,l),l+=n}else if("diagonal"===t.repeatAxis){if(a>0&&n>0)for(;s<e&&l<r;)s+=a,l+=n,this.drawRepeatedPlaceholder(t,s,l)}else if("both"===t.repeatAxis){if(a>0){for(s+=a;s<e;)this.drawRepeatedPlaceholder(t,s,l),s+=a;s=i.left}if(n>0)for(l+=n;l<r;)this.drawRepeatedPlaceholder(t,s,l),l+=n}else if("full"===t.repeatAxis){if(s+=a,n<=0||a<=0)return;for(;l<r;){if(n>0){for(;s<e;)this.drawRepeatedPlaceholder(t,s,l),s+=a;s=i.left}l+=n}}}else this.clearRepeatedPlaceholder(t.id)}},{key:"drawRepeatedPlaceholder",value:function(e,r,a){var n=t('.watermark-placeholder[item="'+e.id+'"]'),i=n.find(".watermark-placeholder-wrapper"),o=i.clone();o.addClass("position-absolute w-auto repeat-clone repeat-clone-"+e.id),o.find(".watermark-text-textarea").css({background:"transparent",width:i.find(".watermark-text-textarea").width()}),"text"===e.type&&o.find(".watermark-text-textarea").attr("contenteditable",!1),o.css({width:n.width(),height:n.height(),left:r,top:a}),e.styles.degree&&this.rotateWatermarkElement(o,e.styles.degree,e.type,e),t("#selected-preview-container .repeated-clones-wrapper").append(o)}},{key:"clearRepeatedPlaceholder",value:function(e){t(".repeat-clone-"+e).remove()}},{key:"updateWatermarkTextOffsets",value:function(e){var r=Math.round(parseFloat(t('[item="'+e.id+'"]').find(".watermark-text-textarea").css("width"))),a=Math.round(parseFloat(t('[item="'+e.id+'"]').find(".watermark-text-textarea").css("height")));return e.width=r,e.height=a,e.botLeft=Math.round(e.absLeft)-Math.round(a*Math.sin(e.styles.degree*Math.PI/180)),e.botTop=Math.round(e.absTop)+Math.round(a*Math.cos(e.styles.degree*Math.PI/180)),this.directUpdateWatermark(e),this.updateWatermarkSpecs(e.id,{width:r,height:a,botTop:Math.round(e.botTop),botLeft:Math.round(e.botLeft)}),e}},{key:"removeWatermark",value:function(e){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];delete this.watermarks[e],delete this.watermarksElements[e],t(document).trigger(a+"_preview_watermark_save_toggle",Object.keys(this.watermarks).length);var n=t('.watermark-placeholder[item="'+e+'"]');n.remove(),t(".repeat-clone-"+e).remove(),r||(t("#"+e+"_header").remove(),t("#"+e+"_specs").remove(),t(".watermark-specs-header"))}},{key:"directUpdateWatermark",value:function(t){var e=t.id;this.watermarks[e]=t}},{key:"updateWatermark",value:function(t,e){return e.position&&(void 0!==e.position.positionType&&(t.positionType=e.position.positionType),void 0!==e.position.top&&(t.absTop=Math.round(e.position.top)),void 0!==e.position.left&&(t.absLeft=Math.round(e.position.left)),void 0!==e.position.positionSpot&&(t.positionSpot=e.position.positionSpot),void 0!==e.position.topPercent&&(t.topPercent=e.position.topPercent),void 0!==e.position.leftPercent&&(t.leftPercent=e.position.leftPercent),void 0!==e.position.centerOffset&&(t.centerOffset=e.position.centerOffset)),e.size&&(void 0!==e.size.width&&(t.width=e.size.width),void 0!==e.size.height&&(t.height=e.size.height)),e.text&&(t.text=e.text),e[a+"_updates_additional"]&&(t=Object.assign(t,e[a+"_updates_additional"])),e.degree&&(t.styles.degree=e.degree),void 0!==e.width&&(t.width=e.width),void 0!==e.height&&(t.height=e.height),this.watermarks[t.id]=t,t}},{key:"updateWatermarkStyles",value:function(e,r){if(f)return e;if("text"===e.type){var a=this.getTextHeight(r.font.fontFamily,r.font.fontSize,this.watermarksElements[e.id].text()),n=this.getTextWidth(r.font.fontFamily,r.font.fontSize,this.watermarksElements[e.id].text());e.baselineOffset=a.descent,e.exactWidth=n,this.updateWatermarkSpecs(e.id,{exactWidth:n,baselineOffset:a.descent})}return e.styles=t.extend(!0,e.styles,r),this.watermarks[e.id]=e,e}},{key:"displayWatermark",value:function(e){var r=t(".watermark-item"),a=e.url;r.find("img").attr("src",a),r.removeClass("d-none")}},{key:"initPDF",value:function(){var e=this;t(".selected-preview.selected-preview-pdf").removeClass("d-none"),t(".selected-preview.selected-preview-pdf").attr("src",o.url+"#view=FitH&toolbar=0&navpanes=0&zoom=100"),t(".selected-preview.selected-preview-pdf").attr("width",o.width+10),t(".selected-preview.selected-preview-pdf").attr("height",o.height+10),t(".selected-preview.selected-preview-pdf").on("load",(function(){e.createPreviewOverlayers(),e.initCurrentWatermarks(!1)})),t(".repeated-clones-wrapper").css("width","98%")}},{key:"createPreviewOverlayers",value:function(){var e='<div class="preview-overlayer" width="'+o.width+'" height="'+o.height+'"></div>',r=t(".selected-preview-pdf");r.after(e),o.width=Math.floor(r.width()),o.height=Math.floor(r.height())}},{key:"previewWatermarks",value:function(e){var r=this;e.preventDefault(),t(".preview-result").addClass("d-none"),t(".img-media-icon-box").remove();var a=t(e.target);this.loading(a,!0);var i=Object.values(this.watermarks),s={action:n.previewWatermarkstemplateAction,nonce:n.nonce,preview_img:o,watermarks:i};t.ajax({method:"POST",url:n.ajaxUrl,dataType:"json",data:s,success:function(t){var e;null!=t&&null!==(e=t.data)&&void 0!==e&&e.msg&&x(t.data.msg,"bg-"+t.data.status),t.success&&r.displayPreview(t.data.result)},error:function(t){var e;null!=t&&null!==(e=t.data)&&void 0!==e&&e.msg&&x(t.data.msg,"bg-danger")},complete:function(){r.loading(a,!1)}})}},{key:"displayPreview",value:function(e){var r=t(".preview-result");r.find(".preview-pdf").attr("src",e),r.find(".preview-pdf").attr("width",o.width),r.find(".preview-pdf").attr("height",o.height),r.find(".preview-pdf").removeClass("d-none"),r.removeClass("d-none")}},{key:"displayGifIcon",value:function(e){var r=t(".gif-icon-box-container");r.html(e),r.removeClass("d-none")}},{key:"loading",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e?(t.addClass("disabled").prop("disabled",!0),t.siblings(".spinner").addClass("is-active")):(t.removeClass("disabled").prop("disabled",!1),t.siblings(".spinner").removeClass("is-active disabled"))}},{key:"rgba2hex",value:function(t){return"#".concat(t.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+\.{0,1}\d*))?\)$/).slice(1).map((function(t,e){return(3===e?Math.round(255*parseFloat(t)):parseFloat(t)).toString(16).padStart(2,"0").replace("NaN","")})).join(""))}},{key:"getTextHeight",value:function(e,r,a){a=t("<span>"+t.trim(a)+"</span>").css({fontFamily:e,fontSize:r+"px"});var n=t('<div style="display: inline-block; width: 1px; height: 0px;"></div>'),i=t("<div></div>");i.append(a,n),t("body").append(i);try{var o={};n.css({verticalAlign:"baseline"}),o.ascent=n.offset().top-a.offset().top,n.css({verticalAlign:"bottom"}),o.height=n.offset().top-a.offset().top,o.descent=o.height-o.ascent}finally{i.remove()}return o}},{key:"getTextWidth",value:function(e,r,a){var n=this.canvas.getContext("2d");n.font=Math.round(parseInt(r))+"px "+e;var i=n.measureText(t.trim(a));return Math.round(Math.abs(i.actualBoundingBoxRight)-Math.abs(i.actualBoundingBoxLeft))}},{key:"getFilterRow",value:function(e,r,a){e.attr("disabled",!0),e.siblings(".spinner").addClass("visible"),t.ajax({method:"POST",url:n.ajaxUrl,data:{action:n.filterRowPlaceholderAction,cpt_slug:r,counter:"group-"+a},success:function(r){if(r.data.length){var n=t(r.data);e.siblings(".context-by-cpt-filter").append(n),n.find(".cpt-terms-select").each((function(e){k(t(this).attr("id"),t(this).data("cpt"),t(this).data("tax"))})),b(n.find(".cpt-author-select").attr("id")),e.data("counter",parseInt(a)+1)}},error:function(t){var e;null!=t&&null!==(e=t.data)&&void 0!==e&&e.msg&&x(t.data.msg,"bg-danger")},complete:function(){e.attr("disabled",!1),e.siblings(".spinner").removeClass("visible")}})}}],l&&c(s.prototype,l),Object.defineProperty(s,"prototype",{writable:!1}),e}();function k(e,r,a){var i=t("#"+e);i.length&&i.select2({placeholder:n.labels.search_term,width:"200px",cache:!0,multiple:!1,allowClear:!0,ajax:{method:"post",url:n.ajaxUrl,dataType:"json",delay:500,data:function(t){return{term:t.term,cpt:r,tax:a,action:n.searchCPTTermsAction}},processResults:function(t){var e=[];return t.data.length&&(e=t.data),{results:e}}},minimumInputLength:3})}function b(e){var r=t("#"+e);r.length&&r.select2({placeholder:n.labels.search_author,width:"200px",cache:!0,multiple:!1,allowClear:!0,ajax:{method:"post",url:n.ajaxUrl,dataType:"json",delay:500,data:function(t){return{author_name:t.term,action:n.searchAuthorAction}},processResults:function(t){var e=[];return t.data.length&&(e=t.data),{results:e}}},minimumInputLength:3})}function x(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"bg-primary",a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=t("."+n.classes_prefix+"-msgs-toast");i.removeClass((function(t,e){return(e.match(/(^|\s)bg-\S+/g)||[]).join(" ")}));var o="";a?(o='<ul class="toast-notice-list">',e.forEach((function(t){o+='<li class="notice-item"><p>'+t+"</p></li>"})),o+="</ul>"):o="<p>"+e+"</p>",i.addClass(r).find(".toast-body").html(o),i.toast("show")}}(jQuery)})();