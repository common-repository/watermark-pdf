/*! For license information please see single-apply-watermarks.min.js.LICENSE.txt */
(()=>{"use strict";function e(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"bg-primary",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4e3,a={success:"bg-primary",error:"bg-danger",danger:"bg-danger",warning:"bg-warning",info:"bg-info"},i=jQuery(".gpls-general-toast"),n=i.find(".btn-close");t=t.startsWith("bg-")?t:t in a?a[t]:t,i.removeClass("bg-primary bg-danger").addClass(t),i.find(".toast-msg").html(e),i.collapse("show"),r&&setTimeout((function(){i.collapse("hide")}),r),n.on("click",(function(){i.collapse("hide")}))}function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"show";"show"===e?jQuery(".loader").removeClass("d-none").show():jQuery(".loader").addClass("d-none").hide()}function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function a(){a=function(){return e};var e={},t=Object.prototype,i=t.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",s=n.asyncIterator||"@@asyncIterator",l=n.toStringTag||"@@toStringTag";function c(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,r){return e[t]=r}}function d(e,t,r,a){var i=t&&t.prototype instanceof h?t:h,n=Object.create(i.prototype),o=new O(a||[]);return n._invoke=function(e,t,r){var a="suspendedStart";return function(i,n){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===i)throw n;return{value:void 0,done:!0}}for(r.method=i,r.arg=n;;){var o=r.delegate;if(o){var s=x(o,r);if(s){if(s===u)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===a)throw a="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);a="executing";var l=p(e,t,r);if("normal"===l.type){if(a=r.done?"completed":"suspendedYield",l.arg===u)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(a="completed",r.method="throw",r.arg=l.arg)}}}(e,r,o),n}function p(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=d;var u={};function h(){}function f(){}function m(){}var v={};c(v,o,(function(){return this}));var w=Object.getPrototypeOf,g=w&&w(w(P([])));g&&g!==t&&i.call(g,o)&&(v=g);var y=m.prototype=h.prototype=Object.create(v);function k(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function b(e,t){function a(n,o,s,l){var c=p(e[n],e,o);if("throw"!==c.type){var d=c.arg,u=d.value;return u&&"object"==r(u)&&i.call(u,"__await")?t.resolve(u.__await).then((function(e){a("next",e,s,l)}),(function(e){a("throw",e,s,l)})):t.resolve(u).then((function(e){d.value=e,s(d)}),(function(e){return a("throw",e,s,l)}))}l(c.arg)}var n;this._invoke=function(e,r){function i(){return new t((function(t,i){a(e,r,t,i)}))}return n=n?n.then(i,i):i()}}function x(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,x(e,t),"throw"===t.method))return u;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var a=p(r,e.iterator,t.arg);if("throw"===a.type)return t.method="throw",t.arg=a.arg,t.delegate=null,u;var i=a.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,u):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function W(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function O(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(W,this),this.reset(!0)}function P(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,a=function t(){for(;++r<e.length;)if(i.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return a.next=a}}return{next:S}}function S(){return{value:void 0,done:!0}}return f.prototype=m,c(y,"constructor",m),c(m,"constructor",f),f.displayName=c(m,l,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,m):(e.__proto__=m,c(e,l,"GeneratorFunction")),e.prototype=Object.create(y),e},e.awrap=function(e){return{__await:e}},k(b.prototype),c(b.prototype,s,(function(){return this})),e.AsyncIterator=b,e.async=function(t,r,a,i,n){void 0===n&&(n=Promise);var o=new b(d(t,r,a,i),n);return e.isGeneratorFunction(r)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},k(y),c(y,l,"Generator"),c(y,o,(function(){return this})),c(y,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var a=t.pop();if(a in e)return r.value=a,r.done=!1,r}return r.done=!0,r}},e.values=P,O.prototype={constructor:O,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(T),!e)for(var t in this)"t"===t.charAt(0)&&i.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(r,a){return o.type="throw",o.arg=e,t.next=r,a&&(t.method="next",t.arg=void 0),!!a}for(var a=this.tryEntries.length-1;a>=0;--a){var n=this.tryEntries[a],o=n.completion;if("root"===n.tryLoc)return r("end");if(n.tryLoc<=this.prev){var s=i.call(n,"catchLoc"),l=i.call(n,"finallyLoc");if(s&&l){if(this.prev<n.catchLoc)return r(n.catchLoc,!0);if(this.prev<n.finallyLoc)return r(n.finallyLoc)}else if(s){if(this.prev<n.catchLoc)return r(n.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<n.finallyLoc)return r(n.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc<=this.prev&&i.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var n=a;break}}n&&("break"===e||"continue"===e)&&n.tryLoc<=t&&t<=n.finallyLoc&&(n=null);var o=n?n.completion:{};return o.type=e,o.arg=t,n?(this.method="next",this.next=n.finallyLoc,u):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),T(r),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var a=r.completion;if("throw"===a.type){var i=a.arg;T(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:P(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),u}},e}function i(e,t,r,a,i,n,o){try{var s=e[n](o),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(a,i)}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var s=function(){function t(e,r,a,i,o,s){var l=arguments.length>6&&void 0!==arguments[6]&&arguments[6],c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:{};n(this,t),this.ajaxUrl=e,this.method=r,this.data=a,this.successCallback=i,this.errorCallback=o,this.completeCallback=s,this.showToast=(null==c?void 0:c.showToast)||!1,this.createNewToast=(null==c?void 0:c.createNewToast)||!1,this.toastDuration=(null==c?void 0:c.toastDuration)||!1,this.showToastHeader=(null==c?void 0:c.showToastHeader)||!1,l&&this.fire()}var r,s,l,c,d;return l=t,c=[{key:"fire",value:function(){var t=this;jQuery.ajax({method:this.method,url:this.ajaxUrl,data:this.data,success:function(r){var a;null!=r&&null!==(a=r.data)&&void 0!==a&&a.message&&t.showToast&&e(r.data.message,r.data.status,t.toastDuration,"",t.showToastHeader,t.createNewToast),t.successCallback(r)},error:function(r){var a,i,n,o;null!=r&&null!==(a=r.responseJSON)&&void 0!==a&&null!==(i=a.data)&&void 0!==i&&i.message&&r.responseJSON.data.message.length&&t.showToast&&e(r.responseJSON.data.message,r.responseJSON.data.status,t.toastDuration,"",t.showToastHeader,t.createNewToast),null!=r&&null!==(n=r.responseJSON)&&void 0!==n&&null!==(o=n.data)&&void 0!==o&&o.message||null==r||!r.responseText||!t.showToast||e(r.responseText,"bg-danger",t.toastDuration,"",!0,!0),t.errorCallback(r)},complete:function(){t.completeCallback()}})}},{key:"asyncFire",value:(r=a().mark((function t(){var r=this;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,jQuery.ajax({method:this.method,url:this.ajaxUrl,data:this.data,success:function(t){var a;return null!=t&&null!==(a=t.data)&&void 0!==a&&a.message&&t.data.message.length&&r.showToast&&e(t.data.message,t.data.status,r.toastDuration,"",r.showToastHeader,r.createNewToast),r.successCallback(t),t},error:function(t){var a,i,n,o;return console.log("error in ajax",t),null!=t&&null!==(a=t.responseJSON)&&void 0!==a&&null!==(i=a.data)&&void 0!==i&&i.message&&t.responseJSON.data.message.length&&r.showToast&&e(t.responseJSON.data.message,t.responseJSON.data.status,r.toastDuration,"",r.showToastHeader,r.createNewToast),null!=t&&null!==(n=t.responseJSON)&&void 0!==n&&null!==(o=n.data)&&void 0!==o&&o.message||null==t||!t.responseText||!r.showToast||e(t.responseText,"bg-danger",r.toastDuration,"",!0,!0),r.errorCallback(t),null!=t&&t.responseJSON?t.responseJSON:t.responseText},complete:function(){r.completeCallback()}});case 3:return t.abrupt("return",t.sent);case 6:return t.prev=6,t.t0=t.catch(0),t.abrupt("return",null!==t.t0&&void 0!==t.t0&&t.t0.responseJSON?t.t0.responseJSON:t.t0.responseText);case 9:case"end":return t.stop()}}),t,this,[[0,6]])})),s=function(){var e=this,t=arguments;return new Promise((function(a,n){var o=r.apply(e,t);function s(e){i(o,a,n,s,l,"next",e)}function l(e){i(o,a,n,s,l,"throw",e)}s(void 0)}))},function(){return s.apply(this,arguments)})}],c&&o(l.prototype,c),d&&o(l,d),Object.defineProperty(l,"prototype",{writable:!1}),t}();function l(e){return l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l(e)}function c(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function d(){d=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",n=a.asyncIterator||"@@asyncIterator",o=a.toStringTag||"@@toStringTag";function s(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{s({},"")}catch(e){s=function(e,t,r){return e[t]=r}}function c(e,t,r,a){var i=t&&t.prototype instanceof h?t:h,n=Object.create(i.prototype),o=new O(a||[]);return n._invoke=function(e,t,r){var a="suspendedStart";return function(i,n){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===i)throw n;return{value:void 0,done:!0}}for(r.method=i,r.arg=n;;){var o=r.delegate;if(o){var s=x(o,r);if(s){if(s===u)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===a)throw a="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);a="executing";var l=p(e,t,r);if("normal"===l.type){if(a=r.done?"completed":"suspendedYield",l.arg===u)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(a="completed",r.method="throw",r.arg=l.arg)}}}(e,r,o),n}function p(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var u={};function h(){}function f(){}function m(){}var v={};s(v,i,(function(){return this}));var w=Object.getPrototypeOf,g=w&&w(w(P([])));g&&g!==t&&r.call(g,i)&&(v=g);var y=m.prototype=h.prototype=Object.create(v);function k(e){["next","throw","return"].forEach((function(t){s(e,t,(function(e){return this._invoke(t,e)}))}))}function b(e,t){function a(i,n,o,s){var c=p(e[i],e,n);if("throw"!==c.type){var d=c.arg,u=d.value;return u&&"object"==l(u)&&r.call(u,"__await")?t.resolve(u.__await).then((function(e){a("next",e,o,s)}),(function(e){a("throw",e,o,s)})):t.resolve(u).then((function(e){d.value=e,o(d)}),(function(e){return a("throw",e,o,s)}))}s(c.arg)}var i;this._invoke=function(e,r){function n(){return new t((function(t,i){a(e,r,t,i)}))}return i=i?i.then(n,n):n()}}function x(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,x(e,t),"throw"===t.method))return u;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var a=p(r,e.iterator,t.arg);if("throw"===a.type)return t.method="throw",t.arg=a.arg,t.delegate=null,u;var i=a.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,u):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function W(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function O(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(W,this),this.reset(!0)}function P(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var a=-1,n=function t(){for(;++a<e.length;)if(r.call(e,a))return t.value=e[a],t.done=!1,t;return t.value=void 0,t.done=!0,t};return n.next=n}}return{next:S}}function S(){return{value:void 0,done:!0}}return f.prototype=m,s(y,"constructor",m),s(m,"constructor",f),f.displayName=s(m,o,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,m):(e.__proto__=m,s(e,o,"GeneratorFunction")),e.prototype=Object.create(y),e},e.awrap=function(e){return{__await:e}},k(b.prototype),s(b.prototype,n,(function(){return this})),e.AsyncIterator=b,e.async=function(t,r,a,i,n){void 0===n&&(n=Promise);var o=new b(c(t,r,a,i),n);return e.isGeneratorFunction(r)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},k(y),s(y,o,"Generator"),s(y,i,(function(){return this})),s(y,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var a=t.pop();if(a in e)return r.value=a,r.done=!1,r}return r.done=!0,r}},e.values=P,O.prototype={constructor:O,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(T),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function a(r,a){return o.type="throw",o.arg=e,t.next=r,a&&(t.method="next",t.arg=void 0),!!a}for(var i=this.tryEntries.length-1;i>=0;--i){var n=this.tryEntries[i],o=n.completion;if("root"===n.tryLoc)return a("end");if(n.tryLoc<=this.prev){var s=r.call(n,"catchLoc"),l=r.call(n,"finallyLoc");if(s&&l){if(this.prev<n.catchLoc)return a(n.catchLoc,!0);if(this.prev<n.finallyLoc)return a(n.finallyLoc)}else if(s){if(this.prev<n.catchLoc)return a(n.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<n.finallyLoc)return a(n.finallyLoc)}}}},abrupt:function(e,t){for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var n=i;break}}n&&("break"===e||"continue"===e)&&n.tryLoc<=t&&t<=n.finallyLoc&&(n=null);var o=n?n.completion:{};return o.type=e,o.arg=t,n?(this.method="next",this.next=n.finallyLoc,u):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),T(r),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var a=r.completion;if("throw"===a.type){var i=a.arg;T(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:P(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),u}},e}function p(e,t,r,a,i,n,o){try{var s=e[n](o),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(a,i)}function u(e){return function(){var t=this,r=arguments;return new Promise((function(a,i){var n=e.apply(t,r);function o(e){p(n,a,i,o,s,"next",e)}function s(e){p(n,a,i,o,s,"throw",e)}o(void 0)}))}}function h(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}!function(e){var r="gpls-wmpdf-watermark-pdf",a="gpls_wmpdf_watermark_pdf",i=window[a+"_localize_vars"],n=null,o={},l={},p="image",f=null,m=!1,v=0,w=0;function g(e){return y.apply(this,arguments)}function y(){return(y=u(d().mark((function e(t){var r;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new s(i.ajaxUrl,"POST",{action:"get_pdf_dimensions",pdfURL:t,nonce:i.nonce},(function(e){e.data&&e.data.msg&&b(e.data.msg,"bg-"+e.data.status)}),(function(e){e.data&&e.data.msg&&b(e.data.msg,"bg-danger")}),(function(){})),e.next=3,r.asyncFire();case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}e.fn.resized=function(t,r){e(this).resize((function(){var a=e(this);a.data("resizeTimeout")&&clearTimeout(a.data("resizeTimeout")),a.data("resizeTimeout",setTimeout(t,r))}))},e(document).on("ready",(function(){var a;l.width=window.outerWidth,l.height=window.outerHeight,[].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]')).map((function(e){return new bootstrap.Tooltip(e)})),[].slice.call(document.querySelectorAll(".accordion-collapse")).map((function(e){return new bootstrap.Collapse(e,{toggle:!1})})),e(".gpls-wmpdf-open-gallery-btn").on("click",(function(s){s.preventDefault();var l=e(this).data("context"),c={title:"select-watermark"===l?i.labels.select_watermark:i.labels.select_image,library:h({orderby:"date",query:!0,post_mime_type:"select-watermark"===l?i.img_mime_types:i.pdf_mime_types},r+"-context-modal",l),button:{text:"select-watermark"===l?i.labels.select_watermark:i.labels.select_image},multiple:!1};(a=wp.media(c)).open(),a.on("select",u(d().mark((function r(){var i,s,c,u;return d().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(i=a.state().get("selection").toJSON(),"select-preview-image"!==l){r.next=24;break}return o=i[0],t("show"),r.next=6,g(o.url);case 6:if(c=r.sent,t("hide"),null==c||null===(s=c.data)||void 0===s||!s.dimensions){r.next=13;break}o.width=c.data.dimensions.width,o.height=c.data.dimensions.height,r.next=14;break;case 13:return r.abrupt("return");case 14:e(".select-watermark-btn-section").removeClass("d-none"),e(".selected-preview-img-id").val(o.id),u=o.type,p="pdf",n.initImage(u),e(".select-watermark-btn-section").removeClass("d-none"),e(".preview-result").addClass("d-none"),e(".save-section").collapse("hide"),r.next=25;break;case 24:"select-watermark"===l&&(v++,w++,n.addWatermark("image",i[0],!0));case 25:case"end":return r.stop()}}),r)}))))})),n=new k}));var k=function(){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.canvas=document.createElement("canvas"),this.activePlaceholder=null,this.editsElement=e(".preview-selected-wrapper .edits"),this.watermarks={},this.watermarksElements={},this.lastTextDegree=0,this.applyWatermarksOptions={createBackup:!0},this.spotsMapping={tl:{left:0,top:0},tm:{left:1,top:0},tr:{left:2,top:0},ml:{left:0,top:1},mm:{left:1,top:1},mr:{left:2,top:1},bl:{left:0,top:2},bm:{left:1,top:2},br:{left:2,top:2}},this.events()}var s,l;return s=t,l=[{key:"events",value:function(){var t=this;e(".edits").on("click",".edits-close",(function(t){e(".preview-selected-wrapper .edits").addClass("d-none")})),e(document).on("mouseenter",".actions",(function(t){e(t.target).removeClass("d-none")})),e(document).on("click",".watermark-placeholder",(function(r){var a=e(r.target),i=(a.hasClass(".watermark-placeholder")?a:a.closest(".watermark-placeholder")).attr("item"),n=e('.watermark-placeholder[item="'+i+'"]');t.activateWatermarkSpecsItem(i),n.css("zIndex",200),n.siblings(".watermark-placeholder").css("zIndex",2)})),e(document).on("click",".accordion-button",(function(t){var r=e(t.target).data("id"),a=e('.watermark-placeholder[item="'+r+'"]');a.css("zIndex",200),a.siblings(".watermark-placeholder").css("zIndex",2)})),e(document).on("mouseenter","#selected-preview-container",(function(t){e(".watermark-placeholder").find(".actions").removeClass("d-none")})),e(document).on("mouseleave","#selected-preview-container",(function(t){e(".watermark-placeholder").find(".actions").addClass("d-none")})),e(document).on("keypress",".watermark-text-textarea",(function(e){13===e.which&&e.preventDefault()})),e(document).on("keyup",".watermark-text-textarea",(function(r){var a=e(r.target),i=a.parents(".watermark-placeholder-text").attr("item"),n=t.watermarks[i];e("#"+i+"_specs").find(".edit-title").val(a.text()),n=t.updateWatermarkTextOffsets(n),t.repeatWatermarkPlaceholder(n)})),e(document).on("mousedown",".watermark-placeholder-rotate-handle",(function(t){e(t.target).parents(".watermark-placeholder").rotatable("instance").startRotate(t)})),e(document).on("click",".actions .action-edit",(function(r){var a=e(r.target).closest(".watermark-placeholder").attr("item");t.activateWatermarkSpecsItem(a)})),e(document).on("click",".watermark-specs-header",(function(t){var r=e(t.target).data("id"),a=e('.watermark-placeholder[item="'+r+'"]');a.length&&(a.find(".actions").removeClass("d-none"),a.siblings().find(".actions").addClass("d-none"))})),e(document).on("click",".accordion-item .action-remove",(function(r){if(confirm(i.labels.remove_watermark)){var a=e(r.target).closest(".accordion-item").data("id");v--,t.removeWatermark(a)}})),e(document).on("click",".actions .action-remove",(function(r){if(confirm(i.labels.remove_watermark)){var a=e(r.target).parents(".watermark-placeholder").attr("item");v--,t.removeWatermark(a)}})),e(document).on("input change",".watermark-specs .edit",(function(a,i){i!==r+"-pypass-repeat"&&clearTimeout(f),f=setTimeout((function(){var r=e(a.target),i=r.data("type"),n=r.val(),o=r.closest(".accordion-item").data("id"),s=t.watermarks[o],l=e('.watermark-placeholder[item="'+o+'"]'),c=e("#"+o+"_specs"),d=s.styles;if("opacity"===i||"degree"===i){if(isNaN(n))return;if("text"===s.type){if(n>90&&n<270)return n=n<t.lastTextDegree?90:270,t.lastTextDegree=n,void c.find(".edit-degree").val(n).trigger("change");t.lastTextDegree=n}d[i]="degree"===i&&n<0?360-Math.abs(n):n}else if("position-type"===i){var p=c.find("."+n+"-position");p.collapse("show"),p.siblings(".position-type-input").collapse("hide"),s=t.updateWatermark(s,{position:{positionType:n}})}else if("position-left-percent"===i){if(isNaN(n))return;s=t.updateWatermark(s,{position:{leftPercent:n}})}else if("position-top-percent"===i){if(isNaN(n))return;s=t.updateWatermark(s,{position:{topPercent:n}})}else if("position-spot"===i)s=t.updateWatermark(s,{position:{positionSpot:n}});else if("position-left"===i){if(isNaN(n))return;s=t.updateWatermark(s,{position:{left:n}})}else if("position-top"===i){if(isNaN(n))return;s=t.updateWatermark(s,{position:{top:n}})}else"position-center-offset"===i?s=t.updateWatermark(s,{position:{centerOffset:r.is(":checked")}}):"width"===i?s=t.updateWatermark(s,{width:n}):"height"===i?s=t.updateWatermark(s,{height:n}):d.font[i]=n;"title"===i&&(s=t.updateWatermark(s,{text:n}),l.find(".watermark-text-textarea").text(n)),t.updateWatermarkPlaceholderStyles(l,d,s),"text"===(s=t.updateWatermarkStyles(s,d)).type&&(s=t.updateWatermarkTextOffsets(s)),t.updateWatermarkPlaceholderStyles(l,d,s),t.repeatWatermarkPlaceholder(s)}),200)})),e(document).on(a+"_preview_watermark_save_toggle",(function(t,r){r?(e(".img-preview").removeClass("d-none"),e(".preview-watermark-preview-btn").removeClass("disabled").prop("disabled",!1),e(".preview-watermark-preview-btn").removeClass("d-none")):(e(".img-preview").addClass("d-none"),e(".preview-watermark-preview-btn").addClass("disabled").prop("disabled",!0),e(".preview-watermark-preview-btn").addClass("d-none"))})),e(document).on("click",".gpls-wmpdf-add-text-watermark",(function(e){e.preventDefault(),v++,w++,n.addWatermark("text",{},!0)})),e(document).on("input",".watermark-text-textarea",(function(r){if(13!==r.keyCode){var a=e(r.target),i=a.parents(".watermark-placeholder-text").attr("item"),n=t.watermarks[i],o=a.text();t.updateWatermark(n,{text:o}),t.updateWatermarkStyles(n,n.styles)}else r.preventDefault()})),e(document).on("click",".preview-watermark-preview-btn",(function(e){t.previewWatermarks(e)})),e(document).on("change",".edit-position-repeat-status",(function(r){var a=e(r.target),i=a.is(":checked"),n=a.data("watermarkid"),o=e("#"+n+"_specs"),s=t.watermarks[n];o.find(".repeat-axis-wrapper").collapse(i?"show":"hide"),s.isRepeat=i,t.directUpdateWatermark(s),t.repeatWatermarkPlaceholder(s)})),e(document).on("change",".repeat-axis-select",(function(r){var a=e(r.target),i=a.val(),n=a.data("watermarkid"),o=t.watermarks[n];o.repeatAxis=i,t.directUpdateWatermark(o),t.repeatWatermarkPlaceholder(o)})),e(document).on("change",".repeat-axis-offset-input",(function(r){var a=e(r.target),i=a.val(),n=a.data("watermarkid"),o=a.data("axistype"),s=t.watermarks[n];"x"===o?s.repeatXAxisOffset=i:s.repeatYAxisOffset=i,t.directUpdateWatermark(s),t.repeatWatermarkPlaceholder(s)})),e(document).on("change",".auto-apply-status",(function(t){var r=e(t.target).is(":checked");e(".apply-context .apply-type").collapse(r?"show":"hide")})),e(document).on("change",".auto-apply-context-posts",(function(t){var r=e(t.target).is(":checked");e("#auto-apply-context-filter-posts").collapse(r?"show":"hide")})),e(document).on("change",".context-posts-cpt",(function(t){var r=e(t.target),a=r.val(),i=r.is(":checked");e(".context-by-cpt-filter-"+a).collapse(i?"show":"hide")})),e(document).on("change",".apply-watermarks-type",(function(r){var a=e(r.target).val();e("#apply-watermarks-image-sizes-option-original"),t.applyWatermarksOptions.applyTemplateType=a,2==a?(e(".create-backup-option").collapse("show"),e(".original-image-size-option").collapse("show"),e(".image-sizes-options-overwrite").collapse("show"),e(".image-sizes-options-new").collapse("hide")):(e(".create-backup-option").collapse("hide"),e(".original-image-size-option").collapse("hide"),e(".image-sizes-options-overwrite").collapse("hide"),e(".image-sizes-options-new").collapse("show")),e(".step-4").show()})),e(".apply-watermarks-create-backup-option").on("change",(function(r){var a=e(r.target).is(":checked");t.applyWatermarksOptions.createBackup=a})),e(document).on("click",".apply-watermarks-submit-btn",(function(e){e.preventDefault(),t.applyWatermarks()})),e(window).on("resize",(function(t){e(".preview-result").addClass("d-none")})),e(window).resized((function(r){var a=e(".selected-preview-"+p);o.width=Math.floor(a.width()),o.height=Math.floor(a.height()),t.initCurrentWatermarks(!0)}),300)}},{key:"initCurrentWatermarks",value:function(){var t,r=this,a=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(a){if(null!=i&&null!==(t=i.current_watermarks)&&void 0!==t&&t.watermarks){var o=i.current_watermarks.watermarks;v=Object.keys(o).length,w=Object.keys(o).length}}else o=this.watermarks;o&&(m=!0,e.each(o,(function(t,a){n&&r.removeWatermark(a.id,!0),r.addWatermark(a.type,a,!1,a),r.initWatermarkSpecs(a.id);var i=e('.watermark-placeholder[item="'+a.id+'"]');r.updateWatermarkPlaceholderStyles(i,a.styles,a),"text"===a.type&&(i.find(".watermark-text-textarea").text(a.text),r.updateWatermarkTextOffsets(a)),r.updateWatermarkStyles(a.id,a.styles),r.updateWatermarkSpecs(a.id,a),r.repeatWatermarkPlaceholder(a)})),m=!1)}},{key:"applyWatermarks",value:function(){var t=this,r=e(".preview-watermark-preview-btn"),a=e(".apply-watermarks-submit-btn");r.attr("disabled",!0),r.next(".spinner").addClass("visible"),a.attr("disabled",!0),a.next(".spinner").addClass("visible"),e(".img-icon-box-container").addClass("d-none");var n=Object.values(this.watermarks),s={action:i.singleApplyWatermarksAction,nonce:i.nonce,preview_img:o,watermarks:n,options:this.applyWatermarksOptions};e.ajax({method:"POST",url:i.ajaxUrl,dataType:"json",data:s,success:function(e){e.data&&e.data.msg&&b(e.data.msg,"bg-"+e.data.status),e.data.status&&e.success&&t.displayImgIcon(e.data.display)},error:function(e){e.data&&e.data.msg&&b(e.data.msg,"bg-danger")},complete:function(){r.attr("disabled",!1),r.next(".spinner").removeClass("visible"),a.attr("disabled",!1),a.next(".spinner").removeClass("visible")}})}},{key:"displayImgIcon",value:function(t){var r=e(".img-icon-box-container");r.html(t),r.removeClass("d-none")}},{key:"calculatePosition",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";t.length||(t=e.positionType);var r=this.spotsMapping[e.positionSpot],a=Math.round(o.width/3),i=Math.round(o.height/3);if("pixel"===t)var n={left:Math.round(r.left*a)+parseInt(e.absLeft),top:Math.round(r.top*i)+parseInt(e.absTop)};else"percent"===t&&(n={left:Math.round(r.left*a)+parseInt(a*parseFloat(e.leftPercent/100)),top:Math.round(r.top*i)+parseInt(i*parseFloat(e.topPercent/100))});return e.centerOffset&&(n.left-=Math.round(e.width/2),n.top-=Math.round(e.height/2)),n}},{key:"updateCurrentWatermarksPosition",value:function(){var t=this;e.each(this.watermarks,(function(r,a){"pixel"===a.positionType?(a.absLeft,a.absTop):(a.topPercent,a.leftPercent);var i=e('.watermark-placeholder[item="'+a.id+'"]');t.updateWatermarkPlaceholderStyles(i,a.styles,a)}))}},{key:"activateWatermarkSpecsItem",value:function(t){var r=e('.accordion-button[data-id="'+t+'"]');r&&r.hasClass("collapsed")&&r.trigger("click")}},{key:"insertWatermarkToList",value:function(t){var a=e("#"+r+"-added-watermarks-list");if(a.length){a.find(".watermarks-list-accordion").append(this.watermarksAccordionItemHTML(t,v));var i=e(".watermark-specs-placeholder").clone().attr("id","watermark-specs-item-"+t.id).removeClass("watermark-specs-placeholder").addClass("watermark-specs").removeClass("d-none");e("#"+t.id+"_specs").find(".accordion-body").html(i),this.initWatermarkSpecs(t.id),e('.watermark-placeholder[item="'+t.id+'"]').find(".watermark-placeholder-wrapper").trigger("click")}}},{key:"watermarksAccordionItemHTML",value:function(e,t){var r=e.id,a=e.type;return'<div class="accordion-item" data-id="'+r+'" >\n            <h4 class="accordion-header watermark-specs-header" id="'+r+'_header" data-index="'+(t-1)+'" data-id="'+r+'">\n                <div class="header-wrapper d-flex flex-row align-items-center">\n                    <button class="accordion-button collapsed" type="button" data-id="'+r+'" data-bs-toggle="collapse" data-bs-target="#'+r+'_specs" aria-expanded="true" aria-controls="'+r+'_specs" >\n                        Watermark '+w+" ["+this.watermarks[r].type+']\n                    </button>\n                    <span class="dashicons dashicons-dismiss action action-remove mx-2 bg-white" style="color:#F00;" type="button" data-id="'+r+'"></span>\n                </div>\n            <input type="hidden" name="watermarks['+r+'][type]" value="'+a+'" />\n            <input type="hidden" name="watermarks['+r+'][id]" value="'+r+'" />\n            <input type="hidden" name="watermarks['+r+'][width]" value="'+e.width+'" />\n            <input type="hidden" name="watermarks['+r+'][height]" value="'+e.height+'" />\n            '.concat("image"===a?'<input type="hidden" name="watermarks['+r+'][url]" value="'+e.url+'" />\n                <input type="hidden" name="watermarks['+r+'][imgID]" value="'+e.imgID+'" />':"",'\n            </h4>\n            <div id="')+r+'_specs" class="accordion-collapse collapse" data-id="'+r+'" aria-labelledby="'+r+'_header" data-bs-parent="#gpls-wmpdf-watermarks-list-accordion" >\n                <div class="accordion-body">\n                </div>\n            </div>\n            </div>'}},{key:"initWatermarkSpecs",value:function(t){var r=e("#watermark-specs-item-"+t);if(r.length){var a=this.watermarks[t];"text"===a.type?(r.find(".edit.edit-title").val(a.text).attr("name","watermarks["+t+"][title]"),r.find(".edit.edit-color").val(a.styles.font.color).attr("name","watermarks["+t+"][color]"),r.find(".edit.edit-font-size").val(a.styles.font.fontSize).attr("name","watermarks["+t+"][fontsize]"),r.find(".edit.edit-font-family").val(a.styles.font.fontFamily).attr("name","watermarks["+t+"][fontfamily]"),r.find(".edit-position-botleft").val(a.botLeft).attr("name","watermarks["+t+"][botLeft]"),r.find(".edit-position-bottop").val(a.botTop).attr("name","watermarks["+t+"][botTop]"),r.find(".edit-position-exactwidth").val(a.exactWidth).attr("name","watermarks["+t+"][exactWidth]"),r.find(".edit-position-baselineoffset").val(a.baselineOffset).attr("name","watermarks["+t+"][baselineOffset]")):"image"===a.type&&r.find(".edit-text").remove(),"text"===a.type&&r.find(".watermark-dimension-wrapper").addClass("d-none"),r.find(".edit.edit-width").val(a.width).attr("name","watermarks["+t+"][width]"),r.find(".edit.edit-height").val(a.height).attr("name","watermarks["+t+"][height]");var i=r.find(".edit-opacity");i.val(a.styles.opacity).attr("name","watermarks["+t+"][opacity]"),i.trigger("change"),r.find(".gpls-wmpdf-watermark-position-spot-"+a.positionSpot).prop("checked",!0),e.each(r.find(".edit-position-spot"),(function(r,a){e(a).attr("name","watermarks["+t+"][positionSpot]")})),r.find(".edit-position-type").attr("name","watermarks["+t+"][positionType]"),r.find(".edit-position-repeat-status").attr("name","watermarks["+t+"][isRepeat]").attr("data-watermarkid",t),r.find(".repeat-axis-select").attr("name","watermarks["+t+"][repeatAxis]").attr("data-watermarkid",t),r.find(".repeat-x-axis-offset-input").val(a.repeatXAxisOffset).attr("name","watermarks["+t+"][repeatXAxisOffset]").attr("data-watermarkid",t),r.find(".repeat-y-axis-offset-input").val(a.repeatYAxisOffset).attr("name","watermarks["+t+"][repeatYAxisOffset]").attr("data-watermarkid",t),r.find(".position-type-"+a.positionType).prop("checked",!0),r.find(".edit-position-center-offset").prop("checked",t.centerOffset),r.find(".edit-position-left").val(a.absLeft).attr("name","watermarks["+t+"][absLeft]"),r.find(".edit-position-top").val(a.absTop).attr("name","watermarks["+t+"][absTop]"),r.find(".edit-position-left-percent").val(a.leftPercent).attr("name","watermarks["+t+"][leftPercent]"),r.find(".edit-position-top-percent").val(a.topPercent).attr("name","watermarks["+t+"][topPercent]"),r.find(".edit-degree").val(a.styles.degree).attr("name","watermarks["+t+"][degree]"),r.find('[data-bs-toggle="tooltip"]').tooltip()}}},{key:"fillInWatermarkEditsList",value:function(e){"text"===e.type&&(this.editsElement.find(".edit-title").val(e.text),this.editsElement.find(".edit-color").val(e.styles.font.color),this.editsElement.find(".edit-font-size").val(e.styles.font.fontSize),this.editsElement.find(".edit-font-family").val(e.styles.font.fontFamily)),this.editsElement.find(".edit-opacity").val(e.styles.opacity).trigger("change")}},{key:"unique_id",value:function(){return"watermark_"+Math.round(Math.random()*Math.round(Math.random()*Date.now()))}},{key:"randomPosition",value:function(e,t){return Math.round(Math.random()*(t-e+1))+e}},{key:"initWaterMarkText",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=this;if(e)var r=e;else{var a=i.labels.watermark+" "+w,n=function(){this.id=t.unique_id(),this.type="text",this.width=50,this.height=30,this.text=a,this.centerOffset=!1,this.isRepeat=!1,this.repeatAxis="",this.repeatXAxisOffset=200,this.repeatYAxisOffset=200,this.positionSpot="mm",this.positionType="pixel",this.absLeft=Math.round(50+50*Object.keys(t.watermarks).length),this.absTop=Math.round(50+50*Object.keys(t.watermarks).length),this.leftPercent=0,this.topPercent=0,this.baselineOffset=5,this.exactWidth=50,this.botLeft=0,this.botTop=0,this.styles={font:{color:"#000000",fontSize:16,fontFamily:"verdana",opacity:1},opacity:1,degree:0}};r=new n}return r}},{key:"initWaterMarkImg",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=this;if(t)var a=t;else{var i=!0;(e.width>o.width||e.height>o.height)&&(i=!1);var n=function(){this.id=r.unique_id(),this.type="image",this.width=i?e.width:150,this.sourceWidth=e.width,this.height=i?e.height:150,this.sourceHeight=e.height,this.imgID=e.id,this.centerOffset=!1,this.isRepeat=!1,this.repeatAxis="",this.repeatXAxisOffset=200,this.repeatYAxisOffset=200,this.positionSpot="mm",this.positionType="pixel",this.absLeft=Math.round(50+50*Object.keys(r.watermarks).length),this.absTop=Math.round(50+50*Object.keys(r.watermarks).length),this.leftPercent=0,this.topPercent=0,this.url=e.url,this.styles={opacity:1,degree:0}};a=new n}return a}},{key:"updateWatermarkPlaceholderStyles",value:function(e,t,r){var a=r.type;if("image"===a)var i=e.find(".img-placeholder img");else{if("text"!==a)return;i=e.find(".watermark-text-textarea")}if(i.length){for(var n in t.font)"fontSize"===n?i.css(n,t.font[n]+"px"):i.css(n,t.font[n]);t.opacity&&i.css("opacity",t.opacity),i.width(r.width),i.height(r.height),t.degree&&this.rotateWatermarkElement(e,t.degree,a,r);var o=this.calculatePosition(r);e.css({left:o.left+"px",top:o.top+"px"})}}},{key:"rotateWatermarkElement",value:function(e,t,r,a){var i="rotate("+t+"deg)";a.centerOffset?(e.css("transform-origin","center center"),e.css("-ms-transform-origin","center center"),e.css("-webkit-transform-origin","center center")):(e.css("transform-origin","0px 0px"),e.css("-ms-transform-origin","0px 0px"),e.css("-webkit-transform-origin","0px 0px")),e.css("transform",i),e.css("-moz-transform",i),e.css("-webkit-transform",i),e.css("-o-transform",i)}},{key:"addWatermark",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"image",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if("image"===t){var s=this.initWaterMarkImg(r,n);this.watermarks[s.id]=s,e(document).trigger(a+"_preview_watermark_save_toggle",Object.keys(this.watermarks).length),this.drawWatermark(s,t,i,o)}else if("text"===t){var l=this.initWaterMarkText(n);this.watermarks[l.id]=l,e(document).trigger(a+"_preview_watermark_save_toggle",Object.keys(this.watermarks).length),this.drawWatermark(l,t,i,o)}}},{key:"drawWatermark",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"image",a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3?arguments[3]:void 0;t=this.drawWatermarkPlaceholder(t,r,a),"text"===r&&a&&(t=this.updateWatermarkTextOffsets(t)),a&&(this.insertWatermarkToList(t),this.openWatermarkSpecsAccordion(t.id)),i&&e("html, body").animate({scrollTop:e('.watermark-placeholder[item="'+t.id+'"]').offset().top-300},500)}},{key:"openWatermarkSpecsAccordion",value:function(t){var r=e('.accordion-button[data-id="'+t+'"]');r&&r.hasClass("collapsed")&&r.trigger("click")}},{key:"resetWatermarkPlaceholder",value:function(e){this.removeWatermark(e.id,!0),this.drawWatermarkPlaceholder(e,e.type,!1)}},{key:"drawWatermarkPlaceholder",value:function(t,r,a){var i=this,n=e(".watermark-"+r+"-placeholder-none").clone().removeClass("watermark-"+r+"-placeholder-none").removeClass("d-none").addClass("watermark-placeholder watermark-placeholder-"+r);n.attr("item",t.id),e(".selected-preview-"+p).after(n),this.setWatermarkStyles(t,n),this.watermarksElements[t.id]||(this.watermarksElements[t.id]={}),this.watermarksElements[t.id]=n;var o={containment:".preview-selected-wrapper",wheelRotate:!1,snap:!0,step:5,rotate:function(t,r){var a=e(t.target).attr("item"),n=Math.round(180*r.angle.current/Math.PI),o=i.watermarks[a],s=o.type;o.styles.degree=n,"text"===s&&(n<-90?(n=-90,r.angle.current=Math.PI*n/180):n>90&&(n=90,r.angle.current=Math.PI*n/180)),-0==n&&(n=0),i.updateWatermarkSpecs(a,{degree:n})},stop:function(t,r){var a=e(t.target).attr("item"),n=Math.round(180*r.angle.current/Math.PI),o=i.watermarks[a];o.styles.degree=n,"text"===o.type&&(o=i.updateWatermarkTextOffsets(o)),-0==n&&(n=0),i.updateWatermarkSpecs(a,{degree:n}),o=i.updateWatermark(o,h({degree:n},"degree",n))}};return n.rotatable(o),"text"===r&&a&&n.find(".watermark-text-textarea").text(t.text),t}},{key:"updateWatermarkSpecs",value:function(t,r){var a=e("#watermark-specs-item-"+t);r.width&&a.find(".edit-width").val(r.width),void 0!==r.height&&a.find(".edit-height").val(r.height),void 0!==r.positionType&&a.find("#gpls-wmpdf-watermark-position-type-"+r.positionType).prop("checked",!0),void 0===r.left&&void 0===r.absLeft||a.find(".edit-position-left").val(r.left||r.absLeft),void 0===r.top&&void 0===r.absTop||a.find(".edit-position-top").val(r.top||r.absTop),void 0!==r.leftPercent&&a.find(".edit-position-left-percent").val(r.leftPercent),void 0!==r.topPercent&&a.find(".edit-position-top-percent").val(r.topPercent),void 0!==r.positionSpot&&a.find(".gpls-wmpdf-watermark-position-spot-"+r.positionSpot).prop("checked",!0),void 0!==r.botLeft&&a.find(".edit-position-botleft").val(r.botLeft),void 0!==r.botTop&&a.find(".edit-position-bottop").val(r.botTop),void 0!==r.exactWidth&&a.find(".edit-position-exactwidth").val(r.exactWidth),void 0!==r.baselineOffset&&a.find(".edit-position-baselineoffset").val(r.baselineOffset),void 0!==r.degree&&a.find(".edit-degree").val(r.degree<0?360-Math.abs(r.degree):r.degree).trigger("change")}},{key:"setWatermarkStyles",value:function(e,t){"image"===e.type&&t.find(".img-placeholder img").attr("src",e.url);var r=t.find(".watermark-text-textarea");r.css("line-height"),"text"===e.type&&(t.css({"font-family":e.styles.font.fontFamily,"font-size":e.styles.font.fontSize,width:"auto !important",height:"auto !important"}),r.css({color:e.styles.font.color})),t.position({my:"left top",at:"left top",of:"#selected-preview-container",collision:"fit"});var a=this.calculatePosition(e);t.css({left:a.left,top:a.top})}},{key:"repeatWatermarkPlaceholder",value:function(e){if(e.isRepeat&&e.repeatAxis.length){var t=o.width,r=o.height,a=parseInt(e.repeatXAxisOffset),i=parseInt(e.repeatYAxisOffset),n=this.calculatePosition(e);this.clearRepeatedPlaceholder(e.id);var s=n.left,l=n.top;if("x"===e.repeatAxis){if(a<=0)return;for(s+=a;s<t;)this.drawRepeatedPlaceholder(e,s,l),s+=a}else if("y"===e.repeatAxis){if(i<=0)return;for(l+=i;l<r;)this.drawRepeatedPlaceholder(e,s,l),l+=i}else if("diagonal"===e.repeatAxis){if(a>0&&i>0)for(;s<t&&l<r;)s+=a,l+=i,this.drawRepeatedPlaceholder(e,s,l)}else if("both"===e.repeatAxis){if(a>0){for(s+=a;s<t;)this.drawRepeatedPlaceholder(e,s,l),s+=a;s=n.left}if(i>0)for(l+=i;l<r;)this.drawRepeatedPlaceholder(e,s,l),l+=i}else if("full"===e.repeatAxis){if(s+=a,i<=0||a<=0)return;for(;l<r;){if(i>0){for(;s<t;)this.drawRepeatedPlaceholder(e,s,l),s+=a;s=n.left}l+=i}}}else this.clearRepeatedPlaceholder(e.id)}},{key:"drawRepeatedPlaceholder",value:function(t,r,a){var i=e('.watermark-placeholder[item="'+t.id+'"]'),n=i.find(".watermark-placeholder-wrapper"),o=n.clone();o.addClass("position-absolute w-auto repeat-clone repeat-clone-"+t.id),o.find(".watermark-text-textarea").css({background:"transparent",width:n.find(".watermark-text-textarea").width()}),"text"===t.type&&o.find(".watermark-text-textarea").attr("contenteditable",!1),o.css({width:i.width(),height:i.height(),left:r,top:a}),t.styles.degree&&this.rotateWatermarkElement(o,t.styles.degree,t.type,t),e("#selected-preview-container .repeated-clones-wrapper").append(o)}},{key:"clearRepeatedPlaceholder",value:function(t){e(".repeat-clone-"+t).remove()}},{key:"updateWatermarkTextOffsets",value:function(t){var r=Math.round(parseFloat(e('[item="'+t.id+'"]').find(".watermark-text-textarea").css("width"))),a=Math.round(parseFloat(e('[item="'+t.id+'"]').find(".watermark-text-textarea").css("height")));return t.width=r,t.height=a,t.botLeft=Math.round(t.absLeft)-Math.round(a*Math.sin(t.styles.degree*Math.PI/180)),t.botTop=Math.round(t.absTop)+Math.round(a*Math.cos(t.styles.degree*Math.PI/180)),this.directUpdateWatermark(t),this.updateWatermarkSpecs(t.id,{width:r,height:a,botTop:Math.round(t.botTop),botLeft:Math.round(t.botLeft)}),t}},{key:"removeWatermark",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];delete this.watermarks[t],delete this.watermarksElements[t],e(document).trigger(a+"_preview_watermark_save_toggle",Object.keys(this.watermarks).length);var i=e('.watermark-placeholder[item="'+t+'"]');i.remove(),e(".repeat-clone-"+t).remove(),r||(e("#"+t+"_header").remove(),e("#"+t+"_specs").remove(),e(".watermark-specs-header"))}},{key:"directUpdateWatermark",value:function(e){var t=e.id;this.watermarks[t]=e}},{key:"updateWatermark",value:function(e,t){return t.position&&(void 0!==t.position.positionType&&(e.positionType=t.position.positionType),void 0!==t.position.top&&(e.absTop=Math.round(t.position.top)),void 0!==t.position.left&&(e.absLeft=Math.round(t.position.left)),void 0!==t.position.positionSpot&&(e.positionSpot=t.position.positionSpot),void 0!==t.position.topPercent&&(e.topPercent=t.position.topPercent),void 0!==t.position.leftPercent&&(e.leftPercent=t.position.leftPercent),void 0!==t.position.centerOffset&&(e.centerOffset=t.position.centerOffset)),t.size&&(void 0!==t.size.width&&(e.width=t.size.width),void 0!==t.size.height&&(e.height=t.size.height)),t.text&&(e.text=t.text),t[a+"_updates_additional"]&&(e=Object.assign(e,t[a+"_updates_additional"])),t.degree&&(e.styles.degree=t.degree),void 0!==t.width&&(e.width=t.width),void 0!==t.height&&(e.height=t.height),this.watermarks[e.id]=e,e}},{key:"updateWatermarkStyles",value:function(t,r){if(m)return t;if("text"===t.type){var a=this.getTextHeight(r.font.fontFamily,r.font.fontSize,this.watermarksElements[t.id].text()),i=this.getTextWidth(r.font.fontFamily,r.font.fontSize,this.watermarksElements[t.id].text());t.baselineOffset=a.descent,t.exactWidth=i,this.updateWatermarkSpecs(t.id,{exactWidth:i,baselineOffset:a.descent})}return t.styles=e.extend(!0,t.styles,r),this.watermarks[t.id]=t,t}},{key:"displayWatermark",value:function(t){var r=e(".watermark-item"),a=t.url;r.find("img").attr("src",a),r.removeClass("d-none")}},{key:"initImage",value:function(t){var r=this;e(".selected-preview.selected-preview-pdf").removeClass("d-none"),e(".selected-preview.selected-preview-image").addClass("d-none"),e(".selected-preview.selected-preview-pdf").attr("src",o.url+"#view=FitH&toolbar=0&navpanes=0&zoom=100"),e(".selected-preview.selected-preview-pdf").attr("width",o.width),e(".selected-preview.selected-preview-pdf").attr("height",o.height),e(".selected-preview.selected-preview-pdf").on("load",(function(){r.createPreviewOverlayers()})),e(".repeated-clones-wrapper").css("width","98%"),e(".select-watermark-btn-section").removeClass("d-none"),e(".preview-result").addClass("d-none"),e(".save-section").collapse("hide"),e(".apply-watermarks-type").prop("checked",!1),e(".apply-watermarks-apply-subsizes-options").collapse("hide"),e(".create-backup-option").collapse("hide"),e(".apply-watermarks-final-step").collapse("hide")}},{key:"createPreviewOverlayers",value:function(){var t='<div class="preview-overlayer" width="'+o.width+'" height="'+o.height+'"></div>',r=e(".selected-preview-"+p);r.after(t),o.width=Math.floor(r.width()),o.height=Math.floor(r.height())}},{key:"previewWatermarks",value:function(t){var r=this;t.preventDefault(),e(".save-section").collapse("hide"),e(".preview-result").addClass("d-none"),e(".img-media-icon-box").remove();var a=e(t.target);this.loading(a,!0);var n=Object.values(this.watermarks),s={action:i.previewWatermarkstemplateAction,nonce:i.nonce,preview_img:o,watermarks:n};e.ajax({method:"POST",url:i.ajaxUrl,dataType:"json",data:s,success:function(t){t.data&&t.data.msg&&b(t.data.msg,"bg-"+t.data.status),t.success&&(r.displayPreview(t.data.result),e(".save-section").collapse("show"))},error:function(e){var t;null!=e&&null!==(t=e.data)&&void 0!==t&&t.msg&&b(e.data.msg,"bg-danger")},complete:function(){r.loading(a,!1)}})}},{key:"displayPreview",value:function(t){var r=e(".preview-result");r.find(".preview-pdf").attr("src",t),r.find(".preview-pdf").attr("width",o.width),r.find(".preview-pdf").attr("height",o.height),r.find(".preview-pdf").removeClass("d-none"),r.removeClass("d-none")}},{key:"displayGifIcon",value:function(t){var r=e(".gif-icon-box-container");r.html(t),r.removeClass("d-none")}},{key:"loading",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];t?(e.addClass("disabled").prop("disabled",!0),e.siblings(".spinner").addClass("is-active")):(e.removeClass("disabled").prop("disabled",!1),e.siblings(".spinner").removeClass("is-active disabled"))}},{key:"rgba2hex",value:function(e){return"#".concat(e.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+\.{0,1}\d*))?\)$/).slice(1).map((function(e,t){return(3===t?Math.round(255*parseFloat(e)):parseFloat(e)).toString(16).padStart(2,"0").replace("NaN","")})).join(""))}},{key:"getTextHeight",value:function(t,r,a){a=e("<span>"+e.trim(a)+"</span>").css({fontFamily:t,fontSize:r+"px"});var i=e('<div style="display: inline-block; width: 1px; height: 0px;"></div>'),n=e("<div></div>");n.append(a,i),e("body").append(n);try{var o={};i.css({verticalAlign:"baseline"}),o.ascent=i.offset().top-a.offset().top,i.css({verticalAlign:"bottom"}),o.height=i.offset().top-a.offset().top,o.descent=o.height-o.ascent}finally{n.remove()}return o}},{key:"getTextWidth",value:function(t,r,a){var i=this.canvas.getContext("2d");i.font=Math.round(parseInt(r))+"px "+t;var n=i.measureText(e.trim(a));return Math.round(Math.abs(n.actualBoundingBoxRight)-Math.abs(n.actualBoundingBoxLeft))}}],l&&c(s.prototype,l),Object.defineProperty(s,"prototype",{writable:!1}),t}();function b(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"bg-primary",a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=e("."+i.classes_prefix+"-msgs-toast");n.removeClass((function(e,t){return(t.match(/(^|\s)bg-\S+/g)||[]).join(" ")}));var o="";a?(o='<ul class="toast-notice-list">',t.forEach((function(e){o+='<li class="notice-item"><p>'+e+"</p></li>"})),o+="</ul>"):o="<p>"+t+"</p>",n.addClass(r).find(".toast-body").html(o),n.toast("show")}}(jQuery)})();